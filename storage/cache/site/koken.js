!function(){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,16)}}(),void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0),function(e,t,n){function r(n){var r=t.console;a[n]||(a[n]=!0,e.migrateWarnings.push(n),r&&r.warn&&!e.migrateMute&&(r.warn("JQMIGRATE: "+n),e.migrateTrace&&r.trace&&r.trace()))}function i(t,i,a,o){if(Object.defineProperty)try{return Object.defineProperty(t,i,{configurable:!0,enumerable:!0,get:function(){return r(o),a},set:function(e){r(o),a=e}}),n}catch(s){}e._definePropertyBroken=!0,t[i]=a}var a={};e.migrateWarnings=[],!e.migrateMute&&t.console&&t.console.log&&t.console.log("JQMIGRATE: Logging is active"),e.migrateTrace===n&&(e.migrateTrace=!0),e.migrateReset=function(){a={},e.migrateWarnings.length=0},"BackCompat"===document.compatMode&&r("jQuery is not compatible with Quirks Mode");var o=e("<input/>",{size:1}).attr("size")&&e.attrFn,s=e.attr,u=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},c=e.attrHooks.value&&e.attrHooks.value.set||function(){return n},l=/^(?:input|button)$/i,d=/^[238]$/,f=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,p=/^(?:checked|selected)$/i;i(e,"attrFn",o||{},"jQuery.attrFn is deprecated"),e.attr=function(t,i,a,u){var c=i.toLowerCase(),m=t&&t.nodeType;return u&&(4>s.length&&r("jQuery.fn.attr( props, pass ) is deprecated"),t&&!d.test(m)&&(o?i in o:e.isFunction(e.fn[i])))?e(t)[i](a):("type"===i&&a!==n&&l.test(t.nodeName)&&t.parentNode&&r("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[c]&&f.test(c)&&(e.attrHooks[c]={get:function(t,r){var i,a=e.prop(t,r);return a===!0||"boolean"!=typeof a&&(i=t.getAttributeNode(r))&&i.nodeValue!==!1?r.toLowerCase():n},set:function(t,n,r){var i;return n===!1?e.removeAttr(t,r):(i=e.propFix[r]||r,i in t&&(t[i]=!0),t.setAttribute(r,r.toLowerCase())),r}},p.test(c)&&r("jQuery.fn.attr('"+c+"') may use property instead of attribute")),s.call(e,t,i,a))},e.attrHooks.value={get:function(e,t){var n=(e.nodeName||"").toLowerCase();return"button"===n?u.apply(this,arguments):("input"!==n&&"option"!==n&&r("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var i=(e.nodeName||"").toLowerCase();return"button"===i?c.apply(this,arguments):("input"!==i&&"option"!==i&&r("jQuery.fn.attr('value', val) no longer sets properties"),e.value=t,n)}};var m,h,g=e.fn.init,v=e.parseJSON,w=/^([^<]*)(<[\w\W]+>)([^>]*)$/;e.fn.init=function(t,n,i){var a;return t&&"string"==typeof t&&!e.isPlainObject(n)&&(a=w.exec(e.trim(t)))&&a[0]&&("<"!==t.charAt(0)&&r("$(html) HTML strings must start with '<' character"),a[3]&&r("$(html) HTML text after last tag is ignored"),"#"===a[0].charAt(0)&&(r("HTML string cannot start with a '#' character"),e.error("JQMIGRATE: Invalid selector string (XSS)")),n&&n.context&&(n=n.context),e.parseHTML)?g.call(this,e.parseHTML(a[2],n,!0),n,i):g.apply(this,arguments)},e.fn.init.prototype=e.fn,e.parseJSON=function(e){return e||null===e?v.apply(this,arguments):(r("jQuery.parseJSON requires a valid JSON string"),null)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(m=e.uaMatch(navigator.userAgent),h={},m.browser&&(h[m.browser]=!0,h.version=m.version),h.chrome?h.webkit=!0:h.webkit&&(h.safari=!0),e.browser=h),i(e,"browser",e.browser,"jQuery.browser is deprecated"),e.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(r,i){return i&&i instanceof e&&!(i instanceof t)&&(i=t(i)),e.fn.init.call(this,r,i,n)},t.fn.init.prototype=t.fn;var n=t(document);return r("jQuery.sub() is deprecated"),t},e.ajaxSetup({converters:{"text json":e.parseJSON}});var y=e.fn.data;e.fn.data=function(t){var i,a,o=this[0];return!o||"events"!==t||1!==arguments.length||(i=e.data(o,t),a=e._data(o,t),i!==n&&i!==a||a===n)?y.apply(this,arguments):(r("Use of jQuery.fn.data('events') is deprecated"),a)};var b=/\/(java|ecma)script/i,x=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return r("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),x.apply(this,arguments)},e.clean||(e.clean=function(t,i,a,o){i=i||document,i=!i.nodeType&&i[0]||i,i=i.ownerDocument||i,r("jQuery.clean() is deprecated");var s,u,c,l,d=[];if(e.merge(d,e.buildFragment(t,i).childNodes),a)for(c=function(e){return!e.type||b.test(e.type)?o?o.push(e.parentNode?e.parentNode.removeChild(e):e):a.appendChild(e):n},s=0;null!=(u=d[s]);s++)e.nodeName(u,"script")&&c(u)||(a.appendChild(u),u.getElementsByTagName!==n&&(l=e.grep(e.merge([],u.getElementsByTagName("script")),c),d.splice.apply(d,[s+1,0].concat(l)),s+=l.length));return d});var S=e.event.add,k=e.event.remove,j=e.event.trigger,F=e.fn.toggle,N=e.fn.live,T=e.fn.die,C="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",M=RegExp("\\b(?:"+C+")\\b"),Q=/(?:^|\s)hover(\.\S+|)\b/,A=function(t){return"string"!=typeof t||e.event.special.hover?t:(Q.test(t)&&r("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(Q,"mouseenter$1 mouseleave$1"))};e.event.props&&"attrChange"!==e.event.props[0]&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&i(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,n,i,a){e!==document&&M.test(t)&&r("AJAX events should be attached to document: "+t),S.call(this,e,A(t||""),n,i,a)},e.event.remove=function(e,t,n,r,i){k.call(this,e,A(t)||"",n,r,i)},e.fn.error=function(){var e=Array.prototype.slice.call(arguments,0);return r("jQuery.fn.error() is deprecated"),e.splice(0,0,"error"),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this)},e.fn.toggle=function(t,n){if(!e.isFunction(t)||!e.isFunction(n))return F.apply(this,arguments);r("jQuery.fn.toggle(handler, handler...) is deprecated");var i=arguments,a=t.guid||e.guid++,o=0,s=function(n){var r=(e._data(this,"lastToggle"+t.guid)||0)%o;return e._data(this,"lastToggle"+t.guid,r+1),n.preventDefault(),i[r].apply(this,arguments)||!1};for(s.guid=a;i.length>o;)i[o++].guid=a;return this.click(s)},e.fn.live=function(t,n,i){return r("jQuery.fn.live() is deprecated"),N?N.apply(this,arguments):(e(this.context).on(t,this.selector,n,i),this)},e.fn.die=function(t,n){return r("jQuery.fn.die() is deprecated"),T?T.apply(this,arguments):(e(this.context).off(t,this.selector||"**",n),this)},e.event.trigger=function(e,t,n,i){return n||M.test(e)||r("Global events are undocumented and deprecated"),j.call(this,e,t,n||document,i)},e.each(C.split("|"),function(t,n){e.event.special[n]={setup:function(){var t=this;return t!==document&&(e.event.add(document,n+"."+e.guid,function(){e.event.trigger(n,null,t,!0)}),e._data(this,n,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,n+"."+e._data(this,n)),!1}}})}(jQuery,window),function(){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},t="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.cancelFullScreen)e.supportsFullScreen=!0;else for(var n=0,r=t.length;r>n;n++)if(e.prefix=t[n],"undefined"!=typeof document[e.prefix+"CancelFullScreen"]){e.supportsFullScreen=!0;break}e.supportsFullScreen&&(e.fullScreenEventName=e.prefix+"fullscreenchange",e.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},e.requestFullScreen=function(e){return""===this.prefix?e.requestFullScreen():e[this.prefix+"RequestFullScreen"]()},e.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){e.supportsFullScreen&&(e.isFullScreen()?e.cancelFullScreen(this):e.requestFullScreen(this))})}),window.fullScreenApi=e}(),function(e){"use strict";e.fn.fitVids=function(t){var n={customSelector:null},r=document.createElement("div"),i=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];return r.className="fit-vids-style",r.innerHTML="&shy;<style>               .fluid-width-video-wrapper {                 width: 100%;                              position: relative;                       padding: 0;                            }                                                                                   .fluid-width-video-wrapper iframe,        .fluid-width-video-wrapper object,        .fluid-width-video-wrapper embed {           position: absolute;                       top: 0;                                   left: 0;                                  width: 100%;                              height: 100%;                          }                                       </style>",e(".fit-vids-style").length<=0&&i.parentNode.insertBefore(r,i),t&&e.extend(n,t),this.each(function(){var t=["iframe[src*='player.vimeo.com']","iframe[src*='www.youtube.com']","iframe[src*='www.youtube-nocookie.com']","iframe[src*='www.kickstarter.com']","iframe[src*='soundcloud.com']","object","embed"];n.customSelector&&t.push(n.customSelector);var r=e(this).find(t.join(","));r.each(function(){var t=e(this);if(!("embed"===this.tagName.toLowerCase()&&t.parent("object").length||t.parent(".fluid-width-video-wrapper").length)){var n="object"===this.tagName.toLowerCase()||t.attr("height")&&!isNaN(parseInt(t.attr("height"),10))?parseInt(t.attr("height"),10):t.height(),r=t.attr("width"),i=isNaN(parseInt(r,10))?t.width():parseInt(r,10),a=n/i;if(!t.attr("id")){var o="fitvid"+Math.floor(999999*Math.random());t.attr("id",o)}t.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*a+"%"),r&&t.parent(".fluid-width-video-wrapper").wrap('<div class="k-video max-width-video-wrapper"></div>').parent(".max-width-video-wrapper").css("max-width",r+"px"),t.removeAttr("height").removeAttr("width")}}),e(window).trigger("resize")})}}(jQuery),function(e){function t(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function n(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function r(e){for(y in x)x[y]=e[T[y]]}function i(e,n){var i,a,o,u,c;if(i=e.keyCode,-1==t(N,i)&&N.push(i),(93==i||224==i)&&(i=91),i in x){x[i]=!0;for(o in k)k[o]==i&&(s[o]=!0)}else if(r(e),s.filter.call(this,e)&&i in b)for(u=0;u<b[i].length;u++)if(a=b[i][u],a.scope==n||"all"==a.scope){c=a.mods.length>0;for(o in x)(!x[o]&&t(a.mods,+o)>-1||x[o]&&-1==t(a.mods,+o))&&(c=!1);(0==a.mods.length&&!x[16]&&!x[18]&&!x[17]&&!x[91]||c)&&a.method(e,a)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function a(e){var n,r=e.keyCode,i=t(N,r);if(i>=0&&N.splice(i,1),(93==r||224==r)&&(r=91),r in x){x[r]=!1;for(n in k)k[n]==r&&(s[n]=!1)}}function o(){for(y in x)x[y]=!1;for(y in k)s[y]=!1}function s(e,t,n){var r,i,a;for(r=h(e),void 0===n&&(n=t,t="all"),a=0;a<r.length;a++)i=[],e=r[a].split("+"),e.length>1&&(i=g(e),e=[e[e.length-1]]),e=e[0],e=F(e),e in b||(b[e]=[]),b[e].push({shortcut:r[a],scope:t,method:n,key:r[a],mods:i})}function u(e,t){var r,i,a=e.split("+"),o=[];if(a.length>1&&(o=g(a),e=a[a.length-1]),e=F(e),void 0===t&&(t=p()),b[e])for(r in b[e])i=b[e][r],i.scope===t&&n(i.mods,o)&&(b[e][r]={})}function c(e){return"string"==typeof e&&(e=F(e)),-1!=t(N,e)}function l(){return N.slice(0)}function d(e){var t=(e.target||e.srcElement).tagName;return"INPUT"!=t&&"SELECT"!=t&&"TEXTAREA"!=t}function f(e){S=e||"all"}function p(){return S||"all"}function m(e){var t,n,r;for(t in b)for(n=b[t],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++}function h(e){var t;return e=e.replace(/\s/g,""),t=e.split(","),""==t[t.length-1]&&(t[t.length-2]+=","),t}function g(e){var t=e.slice(0,e.length-1);for(mi=0;mi<t.length;mi++)t[mi]=k[t[mi]];return t}function v(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}function w(){var t=e.key;return e.key=C,t}var y,b={},x={16:!1,18:!1,17:!1,91:!1},S="all",k={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},j={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},F=function(e){return j[e]||e.toUpperCase().charCodeAt(0)},N=[];for(y=1;20>y;y++)j["f"+y]=111+y;var T={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(y in k)s[y]=!1;v(document,"keydown",function(e){i(e,S)}),v(document,"keyup",a),v(window,"focus",o);var C=e.key;e.key=s,e.key.setScope=f,e.key.getScope=p,e.key.deleteScope=m,e.key.filter=d,e.key.isPressed=c,e.key.getPressedKeyCodes=l,e.key.noConflict=w,e.key.unbind=u,"undefined"!=typeof module&&(module.exports=key)}(this),function(e){function t(e){return e}function n(e){return decodeURIComponent(e.replace(i," "))}function r(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a.json?JSON.parse(e):e}catch(t){}}var i=/\+/g,a=e.cookie=function(i,o,s){if(void 0!==o){if(s=e.extend({},a.defaults,s),"number"==typeof s.expires){var u=s.expires,c=s.expires=new Date;c.setDate(c.getDate()+u)}return o=a.json?JSON.stringify(o):String(o),document.cookie=[a.raw?i:encodeURIComponent(i),"=",a.raw?o:encodeURIComponent(o),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var l=a.raw?t:n,d=document.cookie.split("; "),f=i?void 0:{},p=0,m=d.length;m>p;p++){var h=d[p].split("="),g=l(h.shift()),v=l(h.join("="));if(i&&i===g){f=r(v);break}i||(f[g]=r(v))}return f};a.defaults={},e.removeCookie=function(t,n){return void 0!==e.cookie(t)?(e.cookie(t,"",e.extend(n,{expires:-1})),!0):!1}}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&"object"==typeof module.exports?e(require("jquery")):e(jQuery)}(function(e){function t(){var t=a.settings;if(t.autoDispose&&!e.contains(document.documentElement,this))return e(this).timeago("dispose"),this;var o=n(this);return isNaN(o.datetime)||(0==t.cutoff||Math.abs(i(o.datetime))<t.cutoff)&&e(this).text(r(o.datetime)),this}function n(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:a.datetime(t)});var n=e.trim(t.text());a.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(n.length>0)||a.isTime(t)&&t.attr("title")||t.attr("title",n)}return t.data("timeago")}function r(e){return a.inWords(i(e))}function i(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return t instanceof Date?r(t):"string"==typeof t?r(e.timeago.parse(t)):"number"==typeof t?r(new Date(t)):r(e.timeago.datetime(t))};var a=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,autoDispose:!0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function n(n,i){var a=e.isFunction(n)?n(i,t):n,o=r.numbers&&r.numbers[i]||i;return a.replace(/%d/i,o)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var r=this.settings.strings,i=r.prefixAgo,a=r.suffixAgo;if(this.settings.allowFuture&&0>t&&(i=r.prefixFromNow,a=r.suffixFromNow),!this.settings.allowPast&&t>=0)return this.settings.strings.inPast;var o=Math.abs(t)/1e3,s=o/60,u=s/60,c=u/24,l=c/365,d=45>o&&n(r.seconds,Math.round(o))||90>o&&n(r.minute,1)||45>s&&n(r.minutes,Math.round(s))||90>s&&n(r.hour,1)||24>u&&n(r.hours,Math.round(u))||42>u&&n(r.day,1)||30>c&&n(r.days,Math.round(c))||45>c&&n(r.month,1)||365>c&&n(r.months,Math.round(c/30))||1.5>l&&n(r.year,1)||n(r.years,Math.round(l)),f=r.wordSeparator||"";return void 0===r.wordSeparator&&(f=" "),e.trim([i,d,a].join(f))},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),n=n.replace(/([\+\-]\d\d)$/," $100"),new Date(n)},datetime:function(t){var n=a.isTime(t)?e(t).attr("datetime"):e(t).attr("title");return a.parse(n)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var o={init:function(){var n=e.proxy(t,this);n();var r=a.settings;r.refreshMillis>0&&(this._timeagoInterval=setInterval(n,r.refreshMillis))},update:function(n){var r=n instanceof Date?n:a.parse(n);e(this).data("timeago",{datetime:r}),a.settings.localeTitle&&e(this).attr("title",r.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:a.parse(a.isTime(this)?e(this).attr("datetime"):e(this).attr("title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var n=e?o[e]:o.init;if(!n)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){n.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")});!function(){window.$K={scrollContainer:!1,toggleFullScreen:function(t){var t=t||$(document.documentElement);t.requestFullScreen()},tgif:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",lightbox:{entryUrl:!1,overflow:"auto",entryTitle:!1,solo:!1,complete:function(t,e){document.title=e,location.href!==t&&window.history.replaceState(null,"",t)},cacheEntry:function(t,e){location.href.match(/lightbox\/$/)||(this.entryUrl=location.href,this.entryTitle=document.title,document.title=e,window.history.replaceState({lightboxEntry:!0},document.title),window.history.pushState(null,"",t))},load:function(t){$("body").addClass("k-lightbox-loading");var e={width:"100%",height:"100%",position:"fixed",zIndex:1e4,left:0,top:0,opacity:0};$("<iframe />").css(e).attr({src:t,id:"k-lightbox-iframe"}).on("load",function(){var t=this;requestAnimationFrame(function(){t.contentWindow.focus()})}).appendTo("body"),this.overflow=$("body").css("overflow"),$("body").css("overflow","hidden")},show:function(){$("body").removeClass("k-lightbox-loading"),$(".k-link-lightbox-loading").removeClass("k-link-lightbox-loading"),$(document).trigger("koken:lightbox:loaded"),$("#k-lightbox-iframe").animate({opacity:1},400,function(){$(".k-link-lightbox-loading").removeClass("k-link-lightbox-loading")})},exit:function(t){var e=$("#k-lightbox-iframe");e.length&&(t=t||!1,t||(this.entryUrl&&history.pushState(null,"",this.entryUrl),this.entryTitle&&(document.title=this.entryTitle)),$("body").css("overflow",this.overflow),$("#k-lightbox-iframe").animate({opacity:0},{duration:400,complete:function(){$(this).remove()}}))}},loadUrl:function(t){if($K.lightbox.entryUrl&&$K.lightbox.entryUrl===t)$K.lightbox.exit();else{var e=t.replace(RegExp("https?://"+location.host),""),i=$('a[href="'+e+'"]');window.Turbolinks&&window.Turbolinks.supported?Turbolinks.visit(e):!$K.location.draft&&$.pjax&&i.length?i.first().trigger("click"):location.href=t}},pulse:{plugins:{},groups:{},refs:{},overrides:{},teardown:function(){$.each(this.refs,function(t,e){e.kill()}),this.refs={}},register:function(t){this.refs[t.id]&&(this.refs[t.id].kill(),delete this.refs[t.id]);var e="#"+t.id,i=$(e).data("pulse-group");$(e).children(":not(div.cover)").remove(),this.groups[i]||(this.groups[i]=t.options);var n=this.groups[i],a=["width","height","dataUrl","data","next","previous","toggle","play","pause","fullscreen","restart"];return void 0===n.link_to&&a.push("link_to"),this.overrides[t.id]||(this.overrides[t.id]={}),$.each(a,$.proxy(function(e,i){t.options[i]&&(this.overrides[t.id][i]=t.options[i])},this)),this.refs[t.id]=Pulse(e,$.extend(n,this.overrides[t.id])),$.each(this.plugins,$.proxy(function(e){n[e+"_enabled"]&&this.refs[t.id][e](n)},this)),this.refs[t.id]}},navigation:{sets:[],init:!1,toggleChilds:function(t,e){var i=e&&"none"===e||$(t).hasClass("k-nav-open"),n=t.siblings("ul");n.length&&(i?$(t).removeClass("k-nav-open"):$(t).addClass("k-nav-open"),n.css("display",i?"none":"block"))},nest:function(){var t=$("a.k-nav-set");this.sets.length!==t.length&&(this.sets=t,$.each(this.sets,$.proxy(function(t,e){null===e.onclick&&(e.onclick=$.proxy(function(t){$(".k-nav-current").removeClass("k-nav-current"),this.toggleChilds($(e)),t.preventDefault()},this))},this)),this.setCurrent())},setCurrent:function(t){var e=RegExp("(https?://"+location.host+")?"+$K.location.root_folder+"(/(index|preview).php\\?)?"),t=t||location.href,i=t.replace(e,"").replace(/&rand=.*$/,"").replace(/&preview=.*/,"")||"/";$.each(this.sets,$.proxy(function(t,e){this.toggleChilds($(e),"none")},this)),$(".k-nav-current").removeClass("k-nav-current"),$.each($(".k-nav-root"),function(t,n){var a=!1,o={len:0,el:!1};$.each($(n).find("a:not(.k-nav-set)"),function(t,n){n=$(n);var r=n.attr("href").replace(e,"").replace(/&preview=.*/,"");if(i===r){for(n.addClass("k-nav-current");;){if(n=n.parent(),n.hasClass("k-nav-root"))break;"ul"===n.get(0).nodeName.toLowerCase()&&n.show()}return a=!0,!1}var s=RegExp("^"+r+"(.*)?$");r.length>1&&s.test(i)&&r.length>o.len&&(o.el=n,o.len=r.length)}),!a&&o.el&&o.el.addClass("k-nav-current")}),$('a[href="'+i+'"]').addClass("k-nav-current")}},keyboard:{bind:function(){$("[data-bind-to-key]").each(function(){var t=$(this),e=t.attr("data-bind-to-key");-1!==e.indexOf("→")&&(e=e.replace("→","right")),-1!==e.indexOf("←")&&(e=e.replace("←","left")),key.unbind(e),key(e,function(){var e=t.attr("href");if(!e||"#"===e)return t.trigger("click"),void 0;if(location.pathname!==e&&location.href!==e){var i=$._data(t.get(0),"events")&&$._data(t.get(0),"events").click;if(!i){var n=$._data(document,"events");n&&n.click&&$.each(n.click,function(e,n){return-1!==$.inArray(t.get(0),$(n.selector))?(i=!0,!1):void 0})}i&&void 0===t.attr("data-koken-internal")?t.trigger("click"):$K.loadUrl(e)}})})},scroll:{selector:!1,offset:0,index:0,move:function(t){var e=$(this.selector).filter(":visible"),i=!1,n=!1,a="function"==typeof this.offset?this.offset.call(this):this.offset,o=$(document).scrollTop(),r=$(window).height();return $.each(e,function(e,s){var l=$(s).offset().top;t?l+$(s).height()>o+r&&l>o-a?i=i?Math.min(i,l):l:!n&&l>o&&(n=l):o>l&&l>o-r?i=i?Math.min(i,l):l:o>l&&(n=l)}),!i&&n&&(i=n),t||i!==!1||(i=0),i!==!1&&$("html,body").animate({scrollTop:i+a}),!1},init:function(t,e){this.offset=e||0,this.selector=t,self=this,$(window).off(".kScroll").on("keydown.kScroll",function(t){-1!==$.inArray(t.which,[37,39])&&$K.keyboard.scroll.move(39===t.which)}),$(document).on("click","[data-koken-keyboard-scroll-previous]",function(){return $K.keyboard.scroll.move(!1),!1}),$(document).on("click","[data-koken-keyboard-scroll-next]",function(){return $K.keyboard.scroll.move(!0),!1})}}},lazy:{queue:[],working:[],fails:{},max:4,out:function(t){$K.lazy.working.splice($.inArray(t,$K.lazy.working),1),$K.lazy.worker()},fail:function(t){$K.lazy.fails[t]?$K.lazy.fails[t]++:$K.lazy.fails[t]=1,$K.lazy.fails[t]<3&&$K.lazy.queue.push(t),$K.lazy.out(t)},worker:function(){if($K.lazy.queue.length&&$K.lazy.working.length<$K.lazy.max){var t=$K.lazy.queue.shift(),e=$('img.k-lazy-loading[data-src="'+t+'"]').add('.k-lazy-loading-background[data-src="'+t+'"]'),i=new Image;if($K.lazy.fails[t]&&$K.lazy.fails[t]>2)return;$K.lazy.working.push(t),i.onerror=function(){$K.lazy.fail(t)},i.onload=function(){var i=e.filter("img"),n=e.filter(".k-lazy-loading-background");i.removeClass("k-lazy-loading"),n.removeClass("k-lazy-loading-background");var a=i.first().data("lazy-fade");a?i.css("opacity",.001):a=1;var o=n.first().data("lazy-fade");o&&n.each(function(){$(this).find("i.k-bg-fader").remove();var t=$(this).html();$(this).empty().css("position","relative"),$("<i/>").addClass("k-bg-fader").css({width:"100%",height:"100%","float":"left",backgroundPosition:$(this).css("background-position"),opacity:0,backgroundRepeat:"no-repeat",backgroundSize:"cover",zIndex:1}).appendTo($(this)),$("<span>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2}).html(t).appendTo($(this))}),setTimeout(function(){$K.lazy.out(t),i.attr("src",t),i.attr("data-src",null),i.each(function(){$(this).trigger("k-image-fading",$(this)),$(this).animate({opacity:1},a,function(){$(this).addClass("k-lazy-loaded"),$(this).trigger("k-image-loaded",$(this))})}),n.each(function(){$(this).addClass("k-lazy-background-loaded"),o?$(this).find("i.k-bg-fader").css("backgroundImage","url("+t+")").animate({opacity:1},o,function(){$(this).trigger("k-background-loaded")}):($(this).css("backgroundImage","url("+t+")"),$(this).trigger("k-background-loaded"))})},0)},i.src=t,$K.lazy.worker()}},load:function(){var t=1.3*$(window).height()+$(window).scrollTop(),e=2*$(window).width()+$(window).scrollLeft(),i=$("img.k-lazy-loading").add(".k-lazy-loading-background").filter(function(){return!$(this).attr("data-lazy-hold")&&$(this).attr("data-src")&&$(this).is(":visible")}).sort(function(t,e){var i=$(t).offset(),n=$(e).offset();return i.top===n.top?i.left>n.left?1:-1:i.top>n.top?1:-1});$K.lazy.queue=[],$.each(i,function(i,n){n=$(n);var a=n.offset();if(a.top<=t&&a.top+n.height()>=$(window).scrollTop()&&a.left<=e&&a.left+n.width()>=$(window).scrollLeft()){var o=n.attr("data-src");-1===$.inArray(o,$K.lazy.queue)&&$K.lazy.queue.push(o)}}),$K.lazy.worker()},initTimeout:null,init:function(){var t=$("img.k-lazy-loading"),e=$(".k-lazy-loading-background");t.length&&$.each(t,function(t,e){$(e).attr("src")!==$K.tgif&&$(e).attr("src",$K.tgif)}),(t.length||e.length)&&(clearTimeout(this.initTimeout),this.initTimeout=setTimeout(function(){$K.lazy.load()},250))}},isRetinaCache:null,isRetina:function(){return null!==this.isRetinaCache?this.isRetinaCache:(this.isRetinaCache=$K.retinaEnabled&&("devicePixelRatio"in window&&devicePixelRatio>1||"matchMedia"in window&&matchMedia("(min-resolution:144dpi)").matches),this.isRetinaCache)},retinafyUrl:function(t){return t=t.replace(".2x.","."),this.isRetina()&&(t=t.replace(/(\.\d{9,10})?\.[a-zA-Z]{3,4}$/,function(t){return".2x"+t})),t},layout:{mosaic:function(t){t=t||"ul.k-mosaic";var e=$(t);if(e.length){var i=function(){e.each(function(t,e){var i=e.className.match(/k-mosaic-(\d+)/)[1],n=$(e),a=n.children(),o=a.filter(":not(.k-mosaic-uneven)"),r=(o.length,a.length),s=r%i,l=n.width(),c=l/i,d=parseInt(a.first().css("margin-right"),10);if(a.css({width:Math.floor(c-(i-1)/i*d),height:c}),0!==s){var h=$($.makeArray(a).reverse().slice(0,s));d=Math.ceil((h.length-1)/h.length*d),h.addClass("k-mosaic-uneven").css({width:Math.min(l,Math.floor(l*(100/s)/100-d))})}var u=0,f=1;$.each(n.children(),function(t,e){u+=$(e).outerWidth(!0),f==i||r===t+1?(l>u&&$(e).width($(e).width()+(l-u)),u=0,f=1):f++})}),$K.responsiveBackgrounds(),$K.lazy.init()};$(window).on("k-resize",i),i()}}},loadImages:function(){var t=$("img[data-src]"),e=this;t.length&&$.each(t,function(t,i){var n=$(i),a=e.retinafyUrl(n.attr("data-src"));n.hasClass("k-lazy-loading")?n.attr("data-src",a):n.attr("src",a)})},resizeVideos:function(){$(".mejs-container video").each(function(){$v=$(this);var t=$v.data("aspect"),e=Math.min($v.parents(".mejs-container").parent().width(),$v.data("width")),i=e/t,n=this.player;if(n&&(n.setPlayerSize(e,i),n.setControlsSize()),"native"===this.pluginType){var a={width:e,height:i};$v.attr(a).css(a)}else n&&(n.options.videoWidth=e,n.options.videoHeight=i/t,n.media.setVideoSize&&n.media.setVideoSize(e,i))})},responsiveBackgrounds:function(){var t=$("[data-bg-presets]"),e=this;$.each(t,function(){var t,i=$(this),n=i.width(),a=i.height(),o=n/a,r=!1,s=/([a-z_\.]+)\,([0-9]+)\,([0-9]+)/g,l=i.data("bg-presets"),c=i.data("position")||"focal",d=i.css("background-image"),h=i.data("aspect"),u={backgroundRepeat:"no-repeat",backgroundSize:"cover"};if(0!==n&&0!==a){if("focal"===c){var f=i.data("focal-point").split(","),g=50,p=49;o>=h?p=f[1]:g=f[0],u.backgroundPosition=g+"% "+p+"%"}else u.backgroundPosition=c;for(;(t=s.exec(l))&&(r=e.retinafyUrl(i.data("base")+t[1]+"."+i.data("extension")),!(t[2]>=n&&t[3]>=a)););i.hasClass("k-lazy-loading-background")?i.attr("data-src",r):(r="url("+r+")",r&&r!==d&&(u.backgroundImage=r)),i.css(u)}})},responsiveImages:function(t,e){var i,n,a,o,r,s,l=t||$("img[data-presets]"),c=l.selector,d=(l.length,this),h=$.browser.msie||/Trident\/7\./.test(navigator.userAgent);$.each(l,function(t,e){e=$(e),"object"==typeof e.data("originalDom")&&(e=e.replaceWith(e.data("originalDom")),e.css("opacity",1))}),window.setTimeout(function(){var t=[],l=[],u=[],f=$(c),g=-1!==c.indexOf("data-responsive-hold");f=f.filter(function(){if(!(!g&&$(this).attr("data-responsive-hold")||$(this).parents("script").length||$(this).parents(".k-control-structure").length&&"none"===$(this).parents(".k-control-structure").first().css("display"))){var e=$(this).css(["display","visibility","width","height","paddingLeft","paddingRight","paddingTop","paddingBottom","maxHeight"]);if("none"!==e.display&&"hidden"!==e.visibility){t.push(e);for(var i=0,n=$(this);0===i;){n=n.parent();var a=n.css("display");if("none"===a)return!1;"inline"==a||n.attr("data-koken-ignore-responsive")||(i=n.width())}return u.push(i),l.push({el:n,w:n.width(),h:n.height(),css:n.css(["boxSizing"])}),!0}return!1}}),g&&f.attr("data-responsive-hold",null),$.each(f,function(e,c){c=$(c),$(document).trigger("k-img-resize-start",c),"object"==typeof c.data("originalDom")&&(c=c.replaceWith(c.data("originalDom")));var f=c.data("presets"),g=c.attr("src")||"",p=t.shift(),k=h||-1!==p.width.indexOf("%")?0:parseInt(p.width,10)||0,m=h||-1!==p.height.indexOf("%")?0:parseInt(p.height,10)||0,v=(parseInt(p.paddingLeft,10)||0)+(parseInt(p.paddingRight,10)||0),w=(parseInt(p.paddingTop,10)||0)+(parseInt(p.paddingBottom,10)||0),y=0,b=c,x=!0;if(k-=v,m-=w,10>k&&(k=0),10>m&&(m=0),leafObj=l.shift(),leafObj.el.length){b=leafObj.el,y=u.shift(),s=leafObj.css.boxSizing;var K=Math.max(m,leafObj.h),z=p.maxHeight,C=parseInt(z,10);-1!==z.indexOf("%")&&(C=K*(C/100)),c.data("originalDom")||(k>0&&k!==y?(c.data("originalDom",c.clone().attr({"data-lazy-hold":null})),y=Math.min(y,k)):c.data("originalDom","noreplace")),r=c.data("respond-to")||"width",isNaN(C)||(K=C,"width"===r&&(r=!1));var T,A=y/K,D=/([a-z_\.]+)\,([0-9]+)\,([0-9]+)/g,j=c.data("retain-aspect")||!1,_="1:1"===j;if(i=c.data("base"),n=c.data("extension"),c.attr("data-alt")&&(c.attr("alt",c.data("alt")),c.attr("data-alt",null)),j&&!_){var M=j.split(":");A=M[0]/M[1],K=Math.round(y/A),c.attr({width:y,height:K});var I=g.match(/\,(\d+)\./);if(I){var S=Math.abs(y-I[1])/I[1];if(I[1]>=y||.2>S)return}var U=Math.max(y,K),R={tiny:60,small:100,medium:480,medium_large:800,large:1024,xlarge:1600,huge:2048},O="",Y=!1;$.each(R,function(t,e){if(e>=U){var i=e-U;return(!Y||U-Y>i)&&(O=t),!1}O=t,Y=e}),O=$K.imageDefaults[O],g=i+y+"."+K+"."+O.quality+"."+Math.round(100*O.sharpening)+".crop."+n}else{for(var E=!1,P=!1,q=0,B=0;T=D.exec(f);)if(a=_||-1!==T[1].indexOf(".crop"),o=T[2]/T[3],E!==T[2]||P!==T[3]){if(g=i+(T[1].replace(/\.crop$/,"")+(a?".crop":""))+"."+n,E=P=!1,a){if("width"===r){if(T[2]>=y){B=y,q=y;break}}else if("height"===r||C){if(T[3]>=K){B=K,q=K;break}}else if(T[2]>=y&&T[3]>=K){B=Math.min(y,K),q=B;break}}else if("width"===r){if(T[2]>=y){B=y,q=y/o;break}}else if("height"===r){if(T[3]>=K){q=K,B=K*o;break}}else{if(o>=A&&T[2]>=y){B=y,q=y/o;break}if(A>o&&T[3]>=K){q=K,B=K*o;break}}E=T[2],P=T[3]}var U;U=T?Math.max(T[2],T[3]):Math.max(E,P),E&&("height"===r&&K>P&&(E=K*o,P=E/o),B=E,q=P),B>y&&"width"===r&&(B=y,q=y/o),x=!c.attr("data-longest-side")||c.attr("data-longest-side")<U;var F={"data-longest-side":U},L=function(t){return Math.round(Math.round(10*t)/10)};if(c.attr("width")!=B&&(F.width=L(B)),c.attr("height")!=q&&(F.height=L(q)),!F.width&&!F.height)return;c.attr(F)}g=d.retinafyUrl(g),g!==c.attr("src")&&x&&(c.hasClass("k-lazy-loading")||c.hasClass("k-lazy-loaded")?(c.removeClass("k-lazy-loaded"),c.addClass("k-lazy-loading"),c.attr("data-src",g),c.attr("src",$K.tgif),$(document).trigger("k-image-loading",c)):c.attr("src",g)),$(document).trigger("k-img-resize",c)}}),setTimeout(function(){$K.lazy.init(),$(window).trigger("k-resize"),e&&e.call(d)},1)},1)},infinity:{$target:[],isLoading:!1,bttn:!1,_paused:!1,pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.init(),this.check()},next:function(){if(!$K.infinity._paused&&$K.infinity.$target.length&&$K.location.parameters.page<this.totalPages){$(window).trigger("k-infinite-loading"),$K.location.parameters.page++,this.isLoading=!0;var t=this,e=location.href.match(/&preview=.*/)||"";$.ajax({url:$K.location.root+$K.location.here.replace(/\/$/,"")+"/page/"+$K.location.parameters.page+"/"+e,success:function(e){$.each($(e).find(".k-infinite-load"),function(e,i){$(t.$target[e]).before($(i).children())}),t.isLoading=!1,$(window).trigger("k-infinite-loaded",e),$K.ready(),t.check()}}),$K.location.parameters.page===this.totalPages&&this.bttn&&this.bttn.addClass("k-disabled")}},check:function(){if(!$K.infinity._paused&&this.$target.length&&!this.isLoading){var t=this.$target.first().siblings(":visible").last();t=t.children(":visible").length?t.children(":visible").last():t,t.length&&t.offset().top<$(window).scrollTop()+1.25*$(window).height()&&this.next()}},init:function(){if(!$K.infinity._paused&&!$K.infinity.$target.length){var t=$("span.k-infinite-load");if((t.length||$("br.k-infinite-marker").length)&&($.each(t,function(){$(this).append($("<br/>").css("display","none").addClass("k-infinite-marker")),$(this).replaceWith($(this).html())}),this.$target=$(".k-infinite-marker"),""!==this.selector)){var e=$(this.selector),i=this;this.bttn=e,e.length&&(this.totalPages>1?e.off("click").on("click",function(){i.next()}):e.remove())}}}},textPreview:function(t,e){var i="/text/"+(e?"":"drafts/")+"selection:"+t,n=this.location.host+this.location.real_root_folder+"/admin/#"+i;$("<div/>").attr("id","k_essay_preview").html('You are previewing a draft of this essay. <a href="'+n+'" title="Return to the console">Go back and make edits</a>.').prependTo("body")},_prepDate:function(t){if(!t.utc){var e=new Date;return t.timestamp+60*e.getTimezoneOffset()}return t.timestamp},formattedDate:function(t){var e=this._prepDate(t);return this.date(this.dateFormats.date,e)},formattedTime:function(t){var e=this._prepDate(t);return this.date(this.dateFormats.time,e)},formattedDateTime:function(t){return this.formattedDate(t)+" "+this.formattedTime(t)},date:function(t,e){var i,n,a=this,o=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"],r=/\\?(.?)/gi,s=function(t,e){return n[t]?n[t]():e},l=function(t,e){for(t=String(t);t.length<e;)t="0"+t;return t};return n={d:function(){return l(n.j(),2)},D:function(){return n.l().slice(0,3)},j:function(){return i.getDate()},l:function(){return o[n.w()]+"day"},N:function(){return n.w()||7},S:function(){var t=n.j(),e=t%10;return 3>=e&&1==parseInt(t%100/10,10)&&(e=0),["st","nd","rd"][e-1]||"th"},w:function(){return i.getDay()},z:function(){var t=new Date(n.Y(),n.n()-1,n.j()),e=new Date(n.Y(),0,1);return Math.round((t-e)/864e5)},W:function(){var t=new Date(n.Y(),n.n()-1,n.j()-n.N()+3),e=new Date(t.getFullYear(),0,4);return l(1+Math.round((t-e)/864e5/7),2)},F:function(){return o[6+n.n()]},m:function(){return l(n.n(),2)},M:function(){return n.F().slice(0,3)},n:function(){return i.getMonth()+1},t:function(){return new Date(n.Y(),n.n(),0).getDate()},L:function(){var t=n.Y();return t%4===0&t%100!==0|t%400===0},o:function(){var t=n.n(),e=n.W(),i=n.Y();return i+(12===t&&9>e?1:1===t&&e>9?-1:0)},Y:function(){return i.getFullYear()},y:function(){return n.Y().toString().slice(-2)},a:function(){return i.getHours()>11?"pm":"am"},A:function(){return n.a().toUpperCase()},B:function(){var t=3600*i.getUTCHours(),e=60*i.getUTCMinutes(),n=i.getUTCSeconds();return l(Math.floor((t+e+n+3600)/86.4)%1e3,3)},g:function(){return n.G()%12||12},G:function(){return i.getHours()},h:function(){return l(n.g(),2)},H:function(){return l(n.G(),2)},i:function(){return l(i.getMinutes(),2)},s:function(){return l(i.getSeconds(),2)},u:function(){return l(1e3*i.getMilliseconds(),6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(){var t=new Date(n.Y(),0),e=Date.UTC(n.Y(),0),i=new Date(n.Y(),6),a=Date.UTC(n.Y(),6);return t-e!==i-a?1:0},O:function(){var t=i.getTimezoneOffset(),e=Math.abs(t);return(t>0?"-":"+")+l(100*Math.floor(e/60)+e%60,4)},P:function(){var t=n.O();return t.substr(0,3)+":"+t.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-i.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(r,s)},r:function(){return"D, d M Y H:i:s O".replace(r,s)},U:function(){return i/1e3|0}},this.date=function(t,e){return a=this,i=void 0===e?new Date:e instanceof Date?new Date(e):new Date(1e3*e),t.replace(r,s)},this.date(t,e)},ready:function(){$("noscript").remove(),$("time.k-relative-time").timeago(),$K.responsiveImages(),$K.responsiveBackgrounds(),$K.loadImages(),$K.lazy.init(),$K.navigation.nest(),$K.infinity.init(),$K.keyboard.bind(),$K.layout.mosaic(),$("img").off(".kjs").on("error.kjs",function(){var t=$(this),e=t.data("fails")||0;$K.lazy.working.splice($.inArray(t.attr("src"),$K.lazy.working),1),3>e&&(e++,t.attr("data-src")||t.attr("data-src",t.attr("src")),t.removeClass("k-lazy-loaded").addClass("k-lazy-loading"),setTimeout(function(){$K.lazy.init()},100),t.data("fails",e))}),$(window).off(".kjs");var t,e=$(window).add("body");$K.scrollContainer&&(e=e.add($($K.scrollContainer))),e.off(".kjs").on("scroll.kjs",function(){clearTimeout(t),t=setTimeout(function(){$K.lazy.load(),$K.infinity.bttn||$K.infinity.check(),$(window).trigger("k-scroll")},300)});var i;$(window).on("resize.kjs orientationchange.kjs",function(){$K.resizeVideos(),clearTimeout(i),i=setTimeout(function(){$K.responsiveImages(),$K.responsiveBackgrounds(),$(window).trigger("k-resize")},250);var t=$("#k-lightbox-iframe");t.length&&$(t.get(0).contentDocument).find("html, body").height($(window).height())}),$K.infinity.bttn||$K.infinity.check(),$("body").fitVids(),$(".k-content-embed iframe").show(),$(".k-select").off("change").on("change",function(){"__label__"!==$(this).val()&&$K.loadUrl($K.location.root+$(this).val()+($K.location.preview?"&preview="+$K.location.preview:""))});var n=RegExp("https?://"+location.host+$K.location.root_folder+"(/(index|preview).php\\?)?"),a=document.referrer.replace(n,"");if(/^https?:/.test(a)&&(a=!1),$K.location.urls.album){var o=RegExp($K.location.urls.album.replace(/:[a-z_]+/,"[^/]+")+"/lightbox/?$");o.test(a)&&(a=a.replace(/\/lightbox\/?$/,""))}/\/lightbox\/?$/.test(a)&&$.cookie("koken_referrer")?a=$.cookie("koken_referrer"):/\/lightbox\/?$/.test(a)||$.cookie("koken_referrer",a,{path:"/"}),$K.location.referrer=a,$(document).trigger("k-ready")}},$(document).ready(function(){function t(){var t=$("body").attr("class")||"";$("body").attr("class",t.replace(/k\-source\-([^\s]+)(\sk\-lens\-([^\s]+))?/,$K.location.page_class));var t=$("html").attr("class")||"";$("html").attr("class",t.replace(/k\-source\-([^\s]+)(\sk\-lens\-([^\s]+))?/,$K.location.page_class)),$K.navigation.setCurrent()}window.Turbolinks&&window.Turbolinks.supported||$K.ready(),$(window).on("popstate",function(t){return $K.lightbox.solo?!0:(t.originalEvent.state&&t.originalEvent.state.lightboxEntry?($K.lightbox.entryUrl=!1,$K.lightbox.exit()):window===window.top&&location.href.match(/\/lightbox\/$/)&&($("#k-lightbox-iframe").length||$K.lightbox.load(location.href)),void 0)}),$(document).on("click","a",function(t){if($(this).attr("href").match(/\/lightbox\/(&preview=.*)?$/)&&!location.href.match(/\/lightbox\//)&&(t.preventDefault(),$(this).addClass("k-link-lightbox-loading"),$(document).trigger("koken:lightbox:loading",this),$K.lightbox.load($(this).attr("href"))),$(this).attr("data-koken-share")){var e=$(this).attr("data-koken-share");if("twitter"!==e||-1===document.location.href.indexOf("preview.php")){t.preventDefault();var i={pinterest:320,"google-plus":400,twitter:256},n=560,a=i[e]||450,o=window.screen.height/2-(a/2+50),r=window.screen.width/2-(n/2+10);window.open($(this).attr("href"),"_blank","top="+o+",left="+r+",width="+n+",height="+a)}}}),$(window).on("k-pjax-end",function(){t()}),$(window).on("pjax:transition:start pjax:transition:restore pjax:end",function(t){$.pjaxTransition&&"pjax:end"===t.type||($K.ready(),$K.navigation.setCurrent())}),$(window).on("pjax:transition:end",function(){$("body").fitVids()});var e=$.extend({},$K.location);$(document).on("pjax:send",function(){e=$.extend({},$K.location)}),$(window).on("pjax:transition:beforeRestore",function(){var i=$.extend({},$K.location);$K.location=$.extend({},e,{parameters:{page:1}}),e=i,t()}),$(document).on("page:fetch pjax:start",function(){$(".mejs-container video").each(function(){0===$(this).parents("#pjax-container-staging").length&&(this.player.remove(),$(this).remove())}),$K.lazy.queue=[],$K.infinity.$target=[],$K.pulse.teardown(),$K.lightbox.exit(!0),$(document).trigger("k-page-fetch")}),$(document).on("page:change",function(){$K.ready(),$(document).trigger("k-page-change")}),$(document).on("page:restore",function(){$(document).trigger("k-page-restore")})})}();$K.location = {"root":"","root_folder":"","real_root_folder":"\/koken","rewrite":true,"host":"http:\/\/www.victorbos.nl","hostname":"www.victorbos.nl","site_url":"http:\/\/www.victorbos.nl","preview":false,"draft":false,"theme_path":"\/koken\/storage\/themes\/victor","urls":{"content":"\/content\/:slug\/","tag_content":"\/tags\/:tag_slug\/content\/:slug\/","category_content":"\/categories\/:category_slug\/content\/:slug\/","favorite":"\/favorites\/:slug\/","feature":"\/features\/:slug\/","favorites":"\/favorites\/","album":"\/albums\/:slug\/","tag_album":"\/tags\/:tag_slug\/albums\/:slug\/","category_album":"\/categories\/:category_slug\/albums\/:slug\/","archive_albums":"\/albums\/:year(?:\/:month(?:\/:day)?)?\/","tag_albums":"\/tags\/:slug\/albums\/","category_albums":"\/categories\/:slug\/albums\/","albums":"\/albums\/","set":"\/sets\/:slug\/","sets":"\/sets\/","essay":"\/blog\/:year\/:month\/:slug\/","tag_essay":"\/tags\/:tag_slug\/blog\/:slug\/","category_essay":"\/categories\/:category_slug\/blog\/:slug\/","archive_essays":"\/blog\/:year(?:\/:month(?:\/:day)?)?\/","tag_essays":"\/tags\/:slug\/blog\/","category_essays":"\/categories\/:slug\/blog\/","essays":"\/blog\/","page":"\/pages\/:slug\/","tag":"\/tags\/:slug\/","tags":"\/tags\/","category":"\/categories\/:slug\/","categories":"\/categories\/","timeline":"\/nieuw\/","archive_timeline":"\/nieuw\/:year(?:\/:month)?\/","event_timeline":"\/nieuw\/:year\/:month\/:day\/","tag_contents":"\/tags\/:slug\/","category_contents":"\/categories\/:slug\/","archive_contents":"\/nieuw\/:year\/:month\/:day\/"}};$K.lazy.max = 4;$K.imageDefaults = {"tiny":{"quality":"80","sharpening":"0.7"},"small":{"quality":"80","sharpening":"0.6"},"medium":{"quality":"85","sharpening":"0.6"},"medium_large":{"quality":"85","sharpening":"0.6"},"large":{"quality":"85","sharpening":"0.6"},"xlarge":{"quality":"90","sharpening":"0.3"},"huge":{"quality":"90","sharpening":"0"}};$K.theme = 'victor';$K.retinaEnabled = false;
$K.dateFormats = { date: "j F Y", time: "H:i" };jQuery.extend(jQuery.easing,{def:"ease-in-out",swing:function(t,n,i,e,o){return jQuery.easing[jQuery.easing.def](t,n,i,e,o)},"ease-in":function(t,n,i,e,o){return e*(n/=o)*n+i},"ease-out":function(t,n,i,e,o){return-e*(n/=o)*(n-2)+i},"ease-in-out":function(t,n,i,e,o){return(n/=o/2)<1?e/2*n*n+i:-e/2*(--n*(n-2)-1)+i}});var Pulse=function(){var P={};with(this){!function(t){"function"==typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],t):t(jQuery)}(function(t){function n(n){return!n||void 0!==n.allowPageScroll||void 0===n.swipe&&void 0===n.swipeStatus||(n.allowPageScroll=c),void 0!==n.click&&void 0===n.tap&&(n.tap=n.click),n||(n={}),n=t.extend({},t.fn.swipe.defaults,n),this.each(function(){var e=t(this),o=e.data(S);o||(o=new i(this,n),e.data(S,o))})}function i(n,i){function C(n){if(!(ln()||t(n.target).closest(i.excludedElements,qn).length>0)){var e,o=n.originalEvent?n.originalEvent:n,s=k?o.touches[0]:o;return Un=x,k?Kn=o.touches.length:n.preventDefault(),On=0,Fn=null,Nn=null,Hn=0,An=0,Ln=0,Rn=1,Qn=0,Xn=pn(),jn=_n(),an(),!k||Kn===i.fingers||i.fingers===v||N()?(un(0,s),Yn=Sn(),2==Kn&&(un(1,o.touches[1]),An=Ln=wn(Xn[0].start,Xn[1].start)),(i.swipeStatus||i.pinchStatus)&&(e=M(o,Un))):e=!1,e===!1?(Un=T,M(o,Un),e):(cn(!0),null)}}function D(t){var n=t.originalEvent?t.originalEvent:t;if(Un!==y&&Un!==T&&!rn()){var e,o=k?n.touches[0]:n,s=hn(o);if(Bn=Sn(),k&&(Kn=n.touches.length),Un=b,2==Kn&&(0==An?(un(1,n.touches[1]),An=Ln=wn(Xn[0].start,Xn[1].start)):(hn(n.touches[1]),Ln=wn(Xn[0].end,Xn[1].end),Nn=bn(Xn[0].end,Xn[1].end)),Rn=xn(An,Ln),Qn=Math.abs(An-Ln)),Kn===i.fingers||i.fingers===v||!k||N()){if(Fn=kn(s.start,s.end),R(t,Fn),On=yn(s.start,s.end),Hn=vn(),gn(Fn,On),(i.swipeStatus||i.pinchStatus)&&(e=M(n,Un)),!i.triggerOnTouchEnd||i.triggerOnTouchLeave){var a=!0;if(i.triggerOnTouchLeave){var r=Cn(this);a=Dn(s.end,r)}!i.triggerOnTouchEnd&&a?Un=z(b):i.triggerOnTouchLeave&&!a&&(Un=z(y)),(Un==T||Un==y)&&M(n,Un)}}else Un=T,M(n,Un);e===!1&&(Un=T,M(n,Un))}}function $(t){var n=t.originalEvent;return k&&n.touches.length>0?(sn(),!0):(rn()&&(Kn=Vn),t.preventDefault(),Bn=Sn(),Hn=vn(),H()?(Un=T,M(n,Un)):i.triggerOnTouchEnd||0==i.triggerOnTouchEnd&&Un===b?(Un=y,M(n,Un)):!i.triggerOnTouchEnd&&B()?(Un=y,O(n,Un,p)):Un===b&&(Un=T,M(n,Un)),cn(!1),null)}function E(){Kn=0,Bn=0,Yn=0,An=0,Ln=0,Rn=1,an(),cn(!1)}function I(t){var n=t.originalEvent;i.triggerOnTouchLeave&&(Un=z(y),M(n,Un))}function P(){qn.unbind(En,C),qn.unbind(Mn,E),qn.unbind(In,D),qn.unbind(Pn,$),zn&&qn.unbind(zn,I),cn(!1)}function z(t){var n=t,e=L(),o=F(),s=H();return!e||s?n=T:!o||t!=b||i.triggerOnTouchEnd&&!i.triggerOnTouchLeave?!o&&t==y&&i.triggerOnTouchLeave&&(n=T):n=y,n}function M(t,n){var i=void 0;return K()||U()?i=O(t,n,h):(j()||N())&&i!==!1&&(i=O(t,n,d)),en()&&i!==!1?i=O(t,n,g):on()&&i!==!1?i=O(t,n,f):nn()&&i!==!1&&(i=O(t,n,p)),n===T&&E(t),n===y&&(k?0==t.touches.length&&E(t):E(t)),i}function O(n,c,u){var _=void 0;if(u==h){if(qn.trigger("swipeStatus",[c,Fn||null,On||0,Hn||0,Kn]),i.swipeStatus&&(_=i.swipeStatus.call(qn,n,c,Fn||null,On||0,Hn||0,Kn),_===!1))return!1;if(c==y&&q()){if(qn.trigger("swipe",[Fn,On,Hn,Kn]),i.swipe&&(_=i.swipe.call(qn,n,Fn,On,Hn,Kn),_===!1))return!1;switch(Fn){case e:qn.trigger("swipeLeft",[Fn,On,Hn,Kn]),i.swipeLeft&&(_=i.swipeLeft.call(qn,n,Fn,On,Hn,Kn));break;case o:qn.trigger("swipeRight",[Fn,On,Hn,Kn]),i.swipeRight&&(_=i.swipeRight.call(qn,n,Fn,On,Hn,Kn));break;case s:qn.trigger("swipeUp",[Fn,On,Hn,Kn]),i.swipeUp&&(_=i.swipeUp.call(qn,n,Fn,On,Hn,Kn));break;case a:qn.trigger("swipeDown",[Fn,On,Hn,Kn]),i.swipeDown&&(_=i.swipeDown.call(qn,n,Fn,On,Hn,Kn))}}}if(u==d){if(qn.trigger("pinchStatus",[c,Nn||null,Qn||0,Hn||0,Kn,Rn]),i.pinchStatus&&(_=i.pinchStatus.call(qn,n,c,Nn||null,Qn||0,Hn||0,Kn,Rn),_===!1))return!1;if(c==y&&Q())switch(Nn){case r:qn.trigger("pinchIn",[Nn||null,Qn||0,Hn||0,Kn,Rn]),i.pinchIn&&(_=i.pinchIn.call(qn,n,Nn||null,Qn||0,Hn||0,Kn,Rn));break;case l:qn.trigger("pinchOut",[Nn||null,Qn||0,Hn||0,Kn,Rn]),i.pinchOut&&(_=i.pinchOut.call(qn,n,Nn||null,Qn||0,Hn||0,Kn,Rn))}}return u==p?(c===T||c===y)&&(clearTimeout(Zn),W()&&!Z()?(Gn=Sn(),Zn=setTimeout(t.proxy(function(){Gn=null,qn.trigger("tap",[n.target]),i.tap&&(_=i.tap.call(qn,n,n.target))},this),i.doubleTapThreshold)):(Gn=null,qn.trigger("tap",[n.target]),i.tap&&(_=i.tap.call(qn,n,n.target)))):u==g?(c===T||c===y)&&(clearTimeout(Zn),Gn=null,qn.trigger("doubletap",[n.target]),i.doubleTap&&(_=i.doubleTap.call(qn,n,n.target))):u==f&&(c===T||c===y)&&(clearTimeout(Zn),Gn=null,qn.trigger("longtap",[n.target]),i.longTap&&(_=i.longTap.call(qn,n,n.target))),_}function F(){var t=!0;return null!==i.threshold&&(t=On>=i.threshold),t}function H(){var t=!1;return null!==i.cancelThreshold&&null!==Fn&&(t=fn(Fn)-On>=i.cancelThreshold),t}function A(){return null!==i.pinchThreshold?Qn>=i.pinchThreshold:!0}function L(){var t;return t=i.maxTimeThreshold?Hn>=i.maxTimeThreshold?!1:!0:!0}function R(t,n){if(i.allowPageScroll===c||N())t.preventDefault();else{var r=i.allowPageScroll===u;switch(n){case e:(i.swipeLeft&&r||!r&&i.allowPageScroll!=_)&&t.preventDefault();break;case o:(i.swipeRight&&r||!r&&i.allowPageScroll!=_)&&t.preventDefault();break;case s:(i.swipeUp&&r||!r&&i.allowPageScroll!=m)&&t.preventDefault();break;case a:(i.swipeDown&&r||!r&&i.allowPageScroll!=m)&&t.preventDefault()}}}function Q(){var t=X(),n=Y(),i=A();return t&&n&&i}function N(){return!!(i.pinchStatus||i.pinchIn||i.pinchOut)}function j(){return!(!Q()||!N())}function q(){var t=L(),n=F(),i=X(),e=Y(),o=H(),s=!o&&e&&i&&n&&t;return s}function U(){return!!(i.swipe||i.swipeStatus||i.swipeLeft||i.swipeRight||i.swipeUp||i.swipeDown)}function K(){return!(!q()||!U())}function X(){return Kn===i.fingers||i.fingers===v||!k}function Y(){return 0!==Xn[0].end.x}function B(){return!!i.tap}function W(){return!!i.doubleTap}function V(){return!!i.longTap}function G(){if(null==Gn)return!1;var t=Sn();return W()&&t-Gn<=i.doubleTapThreshold}function Z(){return G()}function J(){return!(1!==Kn&&k||!isNaN(On)&&0!==On)}function tn(){return Hn>i.longTapThreshold&&w>On}function nn(){return!(!J()||!B())}function en(){return!(!G()||!W())}function on(){return!(!tn()||!V())}function sn(){Wn=Sn(),Vn=event.touches.length+1}function an(){Wn=0,Vn=0}function rn(){var t=!1;if(Wn){var n=Sn()-Wn;n<=i.fingerReleaseThreshold&&(t=!0)}return t}function ln(){return!(qn.data(S+"_intouch")!==!0)}function cn(t){t===!0?(qn.bind(In,D),qn.bind(Pn,$),zn&&qn.bind(zn,I)):(qn.unbind(In,D,!1),qn.unbind(Pn,$,!1),zn&&qn.unbind(zn,I,!1)),qn.data(S+"_intouch",t===!0)}function un(t,n){var i=void 0!==n.identifier?n.identifier:0;return Xn[t].identifier=i,Xn[t].start.x=Xn[t].end.x=n.pageX||n.clientX,Xn[t].start.y=Xn[t].end.y=n.pageY||n.clientY,Xn[t]}function hn(t){var n=void 0!==t.identifier?t.identifier:0,i=dn(n);return i.end.x=t.pageX||t.clientX,i.end.y=t.pageY||t.clientY,i}function dn(t){for(var n=0;n<Xn.length;n++)if(Xn[n].identifier==t)return Xn[n]}function pn(){for(var t=[],n=0;5>=n;n++)t.push({start:{x:0,y:0},end:{x:0,y:0},identifier:0});return t}function gn(t,n){n=Math.max(n,fn(t)),jn[t].distance=n}function fn(t){return jn[t]?jn[t].distance:void 0}function _n(){var t={};return t[e]=mn(e),t[o]=mn(o),t[s]=mn(s),t[a]=mn(a),t}function mn(t){return{direction:t,distance:0}}function vn(){return Bn-Yn}function wn(t,n){var i=Math.abs(t.x-n.x),e=Math.abs(t.y-n.y);return Math.round(Math.sqrt(i*i+e*e))}function xn(t,n){var i=n/t*1;return i.toFixed(2)}function bn(){return 1>Rn?l:r}function yn(t,n){return Math.round(Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)))}function Tn(t,n){var i=t.x-n.x,e=n.y-t.y,o=Math.atan2(e,i),s=Math.round(180*o/Math.PI);return 0>s&&(s=360-Math.abs(s)),s}function kn(t,n){var i=Tn(t,n);return 45>=i&&i>=0?e:360>=i&&i>=315?e:i>=135&&225>=i?o:i>45&&135>i?a:s}function Sn(){var t=new Date;return t.getTime()}function Cn(n){n=t(n);var i=n.offset(),e={left:i.left,right:i.left+n.outerWidth(),top:i.top,bottom:i.top+n.outerHeight()};return e}function Dn(t,n){return t.x>n.left&&t.x<n.right&&t.y>n.top&&t.y<n.bottom}var $n=k||!i.fallbackToMouseEvents,En=$n?"touchstart":"mousedown",In=$n?"touchmove":"mousemove",Pn=$n?"touchend":"mouseup",zn=$n?null:"mouseleave",Mn="touchcancel",On=0,Fn=null,Hn=0,An=0,Ln=0,Rn=1,Qn=0,Nn=0,jn=null,qn=t(n),Un="start",Kn=0,Xn=null,Yn=0,Bn=0,Wn=0,Vn=0,Gn=0,Zn=null;try{qn.bind(En,C),qn.bind(Mn,E)}catch(Jn){t.error("events not supported "+En+","+Mn+" on jQuery.swipe")}this.enable=function(){return qn.bind(En,C),qn.bind(Mn,E),qn},this.disable=function(){return P(),qn},this.destroy=function(){return P(),qn.data(S,null),qn},this.option=function(n,e){if(void 0!==i[n]){if(void 0===e)return i[n];i[n]=e}else t.error("Option "+n+" does not exist on jQuery.swipe.options");return null}}var e="left",o="right",s="up",a="down",r="in",l="out",c="none",u="auto",h="swipe",d="pinch",p="tap",g="doubletap",f="longtap",_="horizontal",m="vertical",v="all",w=10,x="start",b="move",y="end",T="cancel",k="ontouchstart"in window,S="TouchSwipe",C={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:"label, button, input, select, textarea, a, .noSwipe"};t.fn.swipe=function(i){var e=t(this),o=e.data(S);if(o&&"string"==typeof i){if(o[i])return o[i].apply(this,Array.prototype.slice.call(arguments,1));t.error("Method "+i+" does not exist on jQuery.swipe")}else if(!(o||"object"!=typeof i&&i))return n.apply(this,arguments);return e},t.fn.swipe.defaults=C,t.fn.swipe.phases={PHASE_START:x,PHASE_MOVE:b,PHASE_END:y,PHASE_CANCEL:T},t.fn.swipe.directions={LEFT:e,RIGHT:o,UP:s,DOWN:a,IN:r,OUT:l},t.fn.swipe.pageScroll={NONE:c,HORIZONTAL:_,VERTICAL:m,AUTO:u},t.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:v}});var _ns={},_handles="fullscreen item itemnext contentclick contentmouseover contentmousemove contentmouseout dataloaded hasloaded waiting transition transitionstart transitionend playing built playbacktimer resizecomplete ended start ready videobegin videoend";_bind=function(t){var n=this;_handles.indexOf(t.type)<0||this.contentContainer.bind(t.type,function(i,e){if(i="boolean"==typeof e||e instanceof Array?e:$.extend({},i,e),t.type==n.triggered){if(!t.fn)return;if("transition"===t.type)t.fn.call(n.container,{current:n.last,next:n.current,forward:n.forward},t.type);else if("playing"===t.type)t.fn.call(n.container,"playing"===n.state?!0:!1,t.type);else{if(i.nodeType&&"transitionend"===t.type)return;t.fn.call(n.container,i.nodeType?$(i):i,t.type)}}})},_queue=function(t){t=t||!1;var n=[],i=this;return{add:function(t){return n.push(t),this},load:function(){for(var e=n.length,o=0;e>o;o++){var s=n[o],a=s.priority||i.loadQueue.internal.length;delete s.priority,t?(s.node.bind("load",function(){_popQueue.call(i)}),i.loadQueue.external.push(s)):1===a?i.loadQueue.internal.unshift(s):i.loadQueue.internal.splice(a,0,s)}n=[],_popQueue.call(i)}}},_popQueue=function(){var t=this.loadQueue.internal.shift();if(!t){if(!this.loadQueue.canLoadExternal)return;t=this.loadQueue.external.shift()}t?t.node?t.node.attr("src",t.src):_popQueue.call(this):(clearInterval(this.loadQueue.interval),this.loadQueue.interval=!1)},_hasLoaded=function(t){var n,i=t.parent("div.pulse-content-container");i.length&&i.data("asset")&&(n=i.data("asset").index),t.addClass("loaded"),n!==this.options.index||0!=i.parent("div").css("opacity")&&!this.options.touchSwipe||(this.contentContainer.trigger(this.triggered="waiting",[!1]),_display.call(this)),this.contentContainer.trigger(this.triggered="hasloaded"),_popQueue.call(this)},_loadItemById=function(t){var n=this.idMap[t];_loadItemByIndex(n)},_loadItemByIndex=function(t,n){n=n||!1,n||_pause.call(this),t<this.options.index?t=-(this.options.index-t):t-=this.options.index,_update.call(this,t,n)},_get=function(t){return this.contentContainer.find('div[data-pulse-container="'+t+'"]')},_pause=function(){this.state="paused",clearTimeout(this.playTimer.id),this.contentContainer.trigger(this.triggered="playing")},_play=function(){this.state="playing",_update.call(this,1),this.contentContainer.trigger(this.triggered="playing")},_options=function(){return this.options},_toggle=function(){this.firstTime=!1,"playing"==this.state?_pause.call(this):_play.call(this)},_toggleFullScreen=function(){var t=Pulse.fullScreenApi;if(t.isFullScreen())this.lastHeight&&this.contentContainer.css("height",this.lastHeight),t.cancelFullScreen(),this.contentContainer.trigger(this.triggered="fullscreen",[!1]);else{this.lastHeight=this.contentContainer.css("height");var n=this.container.children(":not(.pulse-main-container)").height();this.contentContainer.css("height","-webkit-calc(100% - "+n+"px)"),this.contentContainer.css("height","-moz-calc(100% - "+n+"px)"),this.contentContainer.css("height","-ms-calc(100% - "+n+"px)"),this.contentContainer.css("height","-o-calc(100% - "+n+"px)"),this.contentContainer.css("height","calc(100% - "+n+"px)"),t.requestFullScreen(this.options.fullScreenRoot[0]),this.contentContainer.trigger(this.triggered="fullscreen",[!0])}},_startPlaybackTimer=function(){if("undefined"==typeof this.firstTime&&!this.options.autostart)return this.firstTime=!1,void 0;if("playing"===this.state){var t=this,n=+new Date,i={total:this.options.speed};this.playTimer.remaining=this.playTimer.remaining||this.options.speed,clearInterval(this.playTimer.id),this.playTimer.id=setInterval(function(){var e=+new Date;t.playTimer.remaining-=e-n,n=e,i.remaining=Math.max(t.playTimer.remaining,0),i.totalItems=t.totalItems,t.contentContainer.trigger(t.triggered="playbacktimer",i),t.playTimer.remaining<=0&&_update.call(t,1)},50)}},_exists=function(t){var n=$.inArray(t,this.handlers);return-1===n?!1:this.handlers[n]},_loadPreset=function(t,n){n=n||!1;var i,e={width:t.width(),height:t.height()},o=!1,s=t.data("asset"),a={},r=t.find("img.pulse-content-image"),l=Math.max(Math.abs(this.options.index-s.index),1);t.removeClass("loaded");for(var c in s.presets)if(i=s.presets[c],"expand"===this.options.size&&i.width>e.width||i.width>e.width&&i.height>e.height){o=window.$K&&$K.isRetina()?i.hidpi_url:i.url,a.width=i.width,a.height=i.height;break}o||(o=$K.isRetina()?i.hidpi_url:i.url),t.data("size",a);var u={node:r,src:o,priority:l};return n?(_queue.call(this).add(u).load(),void 0):u},_load=function(){var t,n,e=[this.loaded[this.options.index].id],o=this,s=this.touchContainer||this.contentContainer;for(i=1;i<=this.cushion;i++)t=this.options.index-i,0>t&&(t=this.loaded.length+t),this.loaded[t]&&(_get.call(this,this.loaded[t].id).length<=0&&s.append(_build.call(this,t)),e.push(this.loaded[t].id));for(_get.call(this,this.loaded[this.options.index].id).length<=0&&s.append(_build.call(this,this.options.index)),i=1;i<=this.cushion;i++)n=this.options.index+i,n>=this.loaded.length&&(n-=this.loaded.length),this.loaded[n]&&(_get.call(this,this.loaded[n].id).length<=0&&s.append(_build.call(this,n)),e.push(this.loaded[n].id));var a=_queue.call(this);this.contentContainer.find("div.pulse-content-container").each(function(){var t=$(this),n=t.find("img.pulse-content-image"),i=t.data("asset"),s=t.parent(),r=i&&i.id;-1===$.inArray(r,e)?(n.attr("src",""),s.remove()):n.hasClass("loaded")||a.add(_loadPreset.call(o,t))}),a.load()},_ratio=function(t,n){n&&(this.realDims={width:t.parents("div").width(),height:t.parents("div").height()},t=t.data("asset"));var i="expand"!==this.options.size||1/0===this.options.maxHeight?this.realDims.height:this.options.maxHeight;return this.containerRatio=this.containerRatio&&this.containerRatio<1/0?this.containerRatio:this.realDims.width/i,t.aspect_ratio>=this.containerRatio?{w:this.realDims.width,h:Math.round(this.realDims.width/t.aspect_ratio)}:{w:Math.round(i*t.aspect_ratio),h:i}},_kill=function(){this.dead=!0,this.contentContainer.off(),this.state="paused",clearInterval(this.loadQueue.interval),clearTimeout(this.playTimer.id);var t=this.container.attr("id");delete _ns[t],$.each(_ns.all,function(n,i){i&&i.container.attr("id")===t&&_ns.all.splice(n,1)})},_update=function(t,n){if(n=n||!1,!this.transitioning){var i=parseInt(this.options.index,10)+t;if(clearInterval(this.playTimer.id),this.playTimer.remaining=!1,0>t&&!n?(_pause.call(this),this.forward=!1):this.forward=!0,this.loaded.length<=1||this.options&&this.options.loop===!1&&i>=this.loaded.length)return this.contentContainer.trigger(this.triggered="ended"),void 0;this.options.index=0>i?this.loaded.length-1:i>=this.loaded.length?0:i;var e=_get.call(this,this.loaded[this.options.index].id);e.length?e.find("img.pulse-content-image").hasClass("loaded")?_display.call(this):(this.contentContainer.trigger(this.triggered="waiting",[!0]),_loadPreset.call(this,e.find("div.pulse-content-container"),!0)):(this.contentContainer.trigger(this.triggered="waiting",[!0]),e=_build.call(this,this.options.index),this.contentContainer.append(e),_loadPreset.call(this,e.find("div.pulse-content-container"),!0))}},_getItem=function(){return this.currentData},_getNextItem=function(){var t=this.options.index+1;return t>=this.loaded.length&&this.options.loop===!0&&(t=0),this.loaded[t]||!1},_display=function(){if(this.transitioning=!0,this.current&&this.current.css("z-index",9),this.currentData=this.loaded[this.options.index],this.current=_get.call(this,this.currentData.id),"expand"===this.options.size){var t=Math.min(this.options.maxHeight,this.realDims.width/this.currentData.aspect_ratio);this.contentContainer.animate({height:t},0===this.realDims.height||"none"===this.options.transition_type?0:this.options.transition_duration),this.realDims.height=t}if(this.current.css("z-index",10),this.last?(this.last.find(".video-container").css({left:-1e4}),this.last.find("img.pulse-content-image").show()):this.options.autostart===!0&&(this.state="playing",this.contentContainer.trigger(this.triggered="playing")),this.contentContainer.trigger(this.triggered="transitionstart",{dom:this.current,data:this.currentData}),this.contentContainer.trigger(this.triggered="itemnext",{dom:this.current,data:this.currentData}),this.options.next&&!this.options.loop){var n=$(this.options.next);n.length&&(this.currentData.is_last?n.addClass("k-pulse-button-disabled"):n.removeClass("k-pulse-button-disabled"))}if(this.options.previous&&!this.options.loop){var i=$(this.options.previous);i.length&&(this.currentData.is_first?i.addClass("k-pulse-button-disabled"):i.removeClass("k-pulse-button-disabled"))}this.loadQueue.canLoadExternal=!0,this.contentContainer.trigger(this.triggered="transition",this.current),this.last=this.current;var e=this.current.find(".video-container");e.length&&this.currentData.html&&e.css("left","50%")},_build=function(t){var n=this.loaded[t],i=$('<div data-pulse-container="'+n.id+'" />'),e=$("<div />"),o=$("<div />").addClass("pulse-content-ui-container").css("position","absolute"),s=$("<img />").addClass("pulse-content-image"),a=this;n.index=t,n.position=t+1,n.total=this.totalItems,n.is_first=1===n.position,n.is_last=n.position===this.totalItems,i.css({position:"absolute",background:this.options.background,width:"100%",height:"100%",top:0,left:0,right:"auto",bottom:"auto",opacity:0,margin:0,padding:0,border:0,overflow:"hidden",zIndex:9});var r=_position.call(this,n);if(e.addClass("pulse-content-container").css({position:"absolute",width:r.width,height:r.height,left:r.left,top:r.top}).data("asset",n),r.cropped?o.css({width:a.container.width(),height:a.container.height(),top:-r.top,left:-r.left}):o.css({width:"100%",height:"100%"}),s.attr({alt:n.title||n.filename,width:"100%",height:"100%","data-longest-side":Math.max(n.width,n.height),"data-visibility":n.visibility.raw}).css({position:"absolute",top:0,left:0}).one("load",function(){_hasLoaded.call(a,$(this))}),e.append(s),"video"===n.file_type){var l;n.html?(l=$(n.pulse_html||n.html),l.attr({width:"100%",height:"100%"}).css({position:"absolute",top:0,left:0}).appendTo(e)):l=$("<video/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%"}).attr({width:"100%",height:"100%",src:n.original.url});var c=$("<div/>").addClass("video-container").css({position:"absolute",top:"50%",left:"-10000px",width:n.html?"80px":"100%",height:n.html?"80px":"100%",margin:n.html?"-40px 0 0 -40px":0,opacity:.001,zIndex:n.html?1e4:1});c.append(l),e.append(c);var u=$("<div/>").addClass("video-overlay").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:n.html?"none":"block",zIndex:2}).append($("<div/>").addClass("mejs-overlay-button").bind("click touchstart",function(t){t.preventDefault(),t.stopPropagation(),c.data("player").play(),_crop.call(a,n.aspect_ratio)&&e.find(".mejs-controls").css({width:i.width(),left:Math.abs(a.realDims.width/2-i.find(".pulse-content-container").width()/2)});var o=a.container.attr("id");_ns[o].triggers.videoStart.call(a)}));e.append(u),n.html||requestAnimationFrame(function(){$(l).mediaelementplayer({pluginPath:$K.location.real_root_folder+"/app/site/themes/common/js/",success:function(t){c.data("player",t);var n=a.container.attr("id");t.addEventListener("ended",function(){_ns[n].triggers.videoEnd.call(a)}),t.addEventListener("pause",function(){_ns[n].triggers.videoPause.call(a)})}})})}return e.append(o),i.append(e),this.contentContainer.trigger(this.triggered="built",{dom:i,data:n}),i},_data=function(t){t=t||!1;var n=function(t){function n(t){for(var n=t.length-1;n>0;n--){var i=Math.floor(Math.random()*(n+1)),e=t[n];t[n]=t[i],t[i]=e}return t}var i=t.album||!1;if(!t.content)if(t.covers)t.content=t.covers;else{if(!t.albums)return;"random"===this.options.order&&(t.albums=n(t.albums));var e=[];i=[],$.each(t.albums,function(t,n){e.push(n.covers[0]),i.push(n)}),t.content=e}if("random"!==this.options.order||t.albums||(t.content=n(t.content)),this.options.index>t.total-1&&(this.options.index=0),0===t.total)return this.contentContainer.trigger(this.triggered="dataloaded",{items:!1,source:t.site_link||!1}),this.options.fallbackText?(this.container.html('<span class="k-note k-note-pulse" style="display:block;">'+this.options.fallbackText+"</span>"),this.container.get(0).style.height.length&&this.container.find(".k-note").css("line-height",this.container.outerHeight(!0)+"px"),this.container.addClass("k-pulse-no-data")):this.options.fallbackElement&&(this.container.hide(),this.options.fallbackElement.show()),void 0;var o=!1,s=!1;0===this.totalItems&&((t.album||t.albums)&&(this.options.can_link_to_album=!0),"album"===this.options.link_to&&t.album&&(this.options.link_to=t.album.__koken_url),"album"===this.options.link_to&&t.albums&&(this.originalData=t,this.options.link_to="albums"),this.options.dataUrl.match(/limit:[0-9]+/)?(s=!0,this.totalItems=t.content.count):this.totalItems=t.total,this.cushion=Math.max(this.totalItems<2*this.cushion+1?Math.floor((this.totalItems-.5)/2):this.cushion,1),o=!0);var a,r;for(a=0,r=t.content.length;r>a;a++)if(t.content[a].presets){var l=t.content[a];l.parent=$.isArray(i)?i[a]:i,this.loaded.push(l),this.idMap[t.content[a].id]=this.loaded.length-1}if("auto"===this.options.size){var c=0,u=0;$.each(t.content,function(t,n){isNaN(n.aspect_ratio)||(c+=n.aspect_ratio,u++)});var h,d=c/u,p=1/0,g=["1:10","2:10","3:10","4:10","5:10","6:10","7:10","8:10","9:10","10:10","10:9","10:8","10:7","10:6","10:5","10:4","10:3","10:2","10:1","4:3","3:4","3:2","2:3","1:1","16:9"];$.each(g,function(t,n){var i=n.split(":"),e=i[0]/i[1],o=Math.abs(d-e);p>o&&(h=n,p=o)}),this.options.size=h,_setSize.call(this),_resize.call(this)}this.contentContainer.trigger(this.triggered="dataloaded",{items:t.content,source:t.site_link||!1}),o&&(this.options.album_type=t.album?t.album.album_type:t.album_type?t.album_type:!1,this.options.album_id=t.album?t.album.id:t.id?t.id:!1,this.contentContainer.trigger(this.triggered="waiting",[!0]),_load.call(this),this.contentContainer.trigger(this.triggered="ready",this.container)),t.page<t.pages&&!s&&(this.options.dataUrl=this.options.dataUrl.replace(/\/page:[0-9]+/,"")+"/page:"+(t.page+1),_data.call(this))};if(t)n.call(this,t);else{var i=this;$.ajax({url:this.options.dataUrl,dataType:"json",success:function(t){n.call(i,t)}})}},_event=function(t,n,i,e){var o=this;$(document).on(n,t,{},function(t){this.forward=0>e?!1:!0,i.call(o,e,t),t.preventDefault()})},_resizePresets=function(){var t=_queue.call(this),n=this;this.contentContainer.find("div.pulse-content-container").each(function(){var i=$(this),e=i.data("size");"object"==typeof e&&(n.realDims.width>e.width||n.realDims.height>e.height)&&t.add(_loadPreset.call(n,i))}),t.load()},_position=function(t){0===this.realDims.height&&this.options.height&&-1!==this.options.height.indexOf("%")&&_resize.call(this);var n,i,e=this.realDims.width,o="expand"!==this.options.size||1/0===this.options.maxHeight?this.realDims.height:this.options.maxHeight,s=Math.round(e/t.aspect_ratio),a=_crop.call(this,t.aspect_ratio);if(a)o>s&&(s=o,e=Math.round(s*t.aspect_ratio)),i=Math.min(0,Math.max(-(e-this.realDims.width),this.realDims.width/2-e/(100/t.focal_point.x))),n=Math.min(0,Math.max(-(s-o),o/2-s/(100/t.focal_point.y)));else if("expand"!==this.options.size||s>this.options.maxHeight){o="expand"===this.options.size?this.options.maxHeight:o;var r=_ratio.call(this,t);e=r.w,s=r.h,i=this.realDims.width/2-e/2,n=o/2-s/2}return{width:e,height:s,left:i,top:n,cropped:a}},_crop=function(t){var n=1>t,i=this.containerRatio<1;return"fill"===this.options.crop||"adaptive"===this.options.crop&&n===i||"portrait"===this.options.crop&&n||"landscape"===this.options.crop&&!n},_resize=function(){if(!this.dead){var t=this;if(this.options.autoHeight&&this.contentContainer.css({height:this.container.width()*this.options.autoHeight}),this.options.maxHeightAuto&&(this.options.maxHeight=this.container.width()),"expand"===this.options.size&&this.currentData&&this.contentContainer.css("height",Math.min(this.options.maxHeight,this.container.width()/this.currentData.aspect_ratio)),this.realDims={width:this.contentContainer.width(),height:this.contentContainer.height()},0===this.realDims.width&&Pulse.fullScreenApi.isFullScreen())return this.options.fullScreenRoot.css("width","100%"),_resize.call(this),void 0;this.containerRatio=this.realDims.width/this.realDims.height,(-1!==this.options.width.toString().indexOf("%")||-1!==this.options.height.toString().indexOf("%"))&&(window.clearTimeout(this.resizeInterval),this.resizeInterval=window.setTimeout(function(){_resizePresets.call(t)},500)),this.contentContainer.find("div.pulse-content-container").each(function(){var n=$(this);if(n.data("asset")){var i=_position.call(t,n.data("asset"));n.css({width:i.width,height:i.height,left:i.left,top:i.top});var e=n.find("video");e.length&&e[0].player&&(e=e[0].player,e.setPlayerSize(i.width,i.height),e.setControlsSize(),"native"!==e.pluginType&&e.media.setVideoSize&&e.media.setVideoSize(i.width,i.height),_crop.call(t,n.data("asset").aspect_ratio)&&n.find(".mejs-controls").css({width:t.realDims.width,left:Math.abs(i.left)}));var o=n.find(".pulse-content-ui-container");i.cropped?o.css({width:t.container.width(),height:t.container.height(),top:-i.top,left:-i.left}):o.css({width:"100%",height:"100%"})}});var n=this.container.find(".k-note");n.length&&n.outerHeight()!==this.container.height()&&n.css("line-height",this.container.height()+"px")}},_clone=function(t){if(!t)return!1;var n=$(t[0].cloneNode(!0));return n.find("[data-node-uid]").removeAttr("data-node-uid"),n},_setSize=function(){var t="auto"===this.options.size?"3:2":this.options.size,n=t.split(":");this.options.height=n[1]+"/"+n[0];var i,e=this.options.height.split("/"),o=e[0]/e[1];return i=isNaN(this.options.width)?this.container.parent().width()*o:this.options.width*o,this.options.autoHeight=o,i},_setup=function(t,n){var i=$(t),e=i.attr("id");if(_ns[e]={},_ns[e].context=i,_ns[e].container=i,_ns[e].dead=!1,_ns[e].parent=i.parent(),_ns[e].platform=window.onorientationchange?4:10,_ns[e].handlers=[],_ns[e].loaded=[],_ns[e].triggers=[],_ns[e].touch={},_ns[e].playTimer={id:0,remaining:!1},_ns[e].cushion=3,_ns[e].realDims={},_ns[e].forward=!0,_ns[e].transitioning=!1,_ns[e].touch={},_ns[e].totalItems=0,_ns[e].idMap={},_ns[e].loadQueue={internal:[],external:[],canLoadExternal:!1,interval:!1},_ns[e].stack=0,_ns[e].fsElWidth=0,_ns[e].options={},_ns[e].options.album_id=!1,_ns[e].options.album_type=!1,_ns[e].options.width=n&&n.width?n.width:"100%",_ns[e].options.height=n&&n.height?n.height:!1,_ns[e].options.background=n&&n.background||_ns[e].container.css("background"),_ns[e].options.speed=1e3*(n&&n.speed||5),_ns[e].options.index=n&&n.index||0,_ns[e].options.crop=n&&n.crop||"none",_ns[e].options.dataUrl=n&&n.dataUrl||"/api.php?/content",_ns[e].options.autoHeight=!1,_ns[e].options.size=n&&n.size&&("auto"===n.size||"expand"===n.size||n.size.indexOf(":")>0)&&n.size||!1,_ns[e].options.maxHeight=parseInt(i.css("max-height"),10),_ns[e].options.maxHeightAuto=!1,_ns[e].options.allowFullScreen=n&&n.hasOwnProperty("allowfullscreen")?n.allowfullscreen:!0,_ns[e].options.fullScreenRoot=n&&n.fullscreenroot&&$(n.fullscreenroot)||_ns[e].container,_ns[e].options.fallbackText=n&&n.fallbacktext||!1,_ns[e].options.fallbackElement=n&&n.fallbackelement?$(n.fallbackelement):!1,_ns[e].options.link_to=n&&"false"!==n.link_to&&n.link_to,_ns[e].options.transition_duration=n&&n.transition_duration||"500ms",_ns[e].options.data=n.data||!1,_ns[e].options.order=n&&n.random===!0?"random":"default",_ns[e].options.album_url=n.albumUrl||!1,_ns[e].options.can_link_to_album=n.can_link_to_album||!1,_ns[e].options.touchSwipe=void 0!==n.swipe?n.swipe:!0,_ns[e].options.touchSwipe&&("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)){var o=["Webkit","Moz","O","ms",""],s=!1;o.forEach(function(t){return t+"Transform"in document.body.style?(s=t,!1):void 0}),s?(s.length&&(s="-"+s.toLowerCase()+"-"),_ns[e].options.touchSwipePrefix=s):_ns[e].options.touchSwipe=!1}else _ns[e].options.touchSwipe=!1;_ns[e].options.touchSwipe&&(_ns[e].cushion=2),_ns[e].options.transition_duration=function(){var t=_ns[e].options.transition_duration,n=parseFloat(t,10),i=parseInt(t,10);return 0===n?0:(n>0&&i.toString().length<=2&&(t+="s"),/\dms$/.test(t)?parseInt(t,10):/\ds$/.test(t)?1e3*parseFloat(t,10):t)}(),_ns[e].options.link_to&&-1!==$.inArray(n.link_to,["lightbox","content","album"])&&!window.$K&&(_ns[e].options.link_to=!1),isNaN(_ns[e].options.maxHeight)&&(_ns[e].options.maxHeight=i.width(),_ns[e].options.maxHeightAuto=!0),_ns[e].options.size||_ns[e].options.height||(_ns[e].options.size="3:2");var a=_ns[e].options.height;_ns[e].options.size&&"expand"!==_ns[e].options.size&&(a=_setSize.call(_ns[e])),n&&(_ns[e].options.transition=n.transition_type?n.transition_type:"dissolve",_ns[e].options.transition_easing=n.transition_easing?n.transition_easing:"ease-in-out",_ns[e].options.loop="undefined"==typeof n.loop?!0:n.loop,_ns[e].options.autostart="undefined"==typeof n.autostart?!0:n.autostart,n.next&&_event.call(_ns[e],n.next,"click",function(){(this.options.loop||!this.currentData.is_last)&&_update.call(this,1)}),n.previous&&_event.call(_ns[e],n.previous,"click",function(){(this.options.loop||!this.currentData.is_first)&&_update.call(this,-1)}),n.restart&&_event.call(_ns[e],n.restart,"click",function(){_loadItemByIndex.call(this,0,!0)}),n.toggle&&_event.call(_ns[e],n.toggle,"click",_toggle),n.play&&_event.call(_ns[e],n.play,"click",_play),n.pause&&_event.call(_ns[e],n.pause,"click",_pause),n.pause&&_event.call(_ns[e],n.pause,"click",_pause),n.fullscreen&&(Pulse.fullScreenApi.supportsFullScreen?_event.call(_ns[e],n.fullscreen,"click",_toggleFullScreen):$(n.fullscreen).addClass("k-pulse-button-disabled"))),_ns[e].container.css({background:_ns[e].options.background,position:"relative",width:_ns[e].options.width}),"expand"===_ns[e].options.size?a=0:-1!==String(a).indexOf("%")&&_ns[e].container.css("height",a),_ns[e].contentContainer=$("<div/>").css({width:_ns[e].options.width,height:a,position:"relative"}).attr("class","pulse-main-container"),_ns[e].options.link_to&&_ns[e].contentContainer.css("cursor","pointer");
var r=["click","mousedown","mouseover","mousemove","mouseout"];if(_ns[e].options.touchSwipe){var i=_ns[e];_ns[e].contentContainer.css("overflow","hidden"),_ns[e].touchContainer=$("<div/>").css({height:"100%",position:"relative"}).bind("webkitTransitionEnd mozTransitionEnd msTransitionEnd oTransitionEnd transitionend",function(){if($(this).css(i.options.touchSwipePrefix+"transition",""),i.options.transition_duration="500ms",i.transitioning){if(_load.call(i),i.current.css("left",0),$(this).css(i.options.touchSwipePrefix+"transform","translate3d(0,0,0)"),1===i.totalItems)return;for(var t=i.totalItems<5?i.options.index-1:i.options.index-2,n=i.totalItems<5?i.options.index+(i.totalItems-1):i.options.index+3,e=t;n>e;e++)if(e!==i.options.index){var o=e<i.options.index,s=e,a=Math.abs(s-i.options.index);s>=i.loaded.length&&(s-=i.loaded.length),0>s&&(s=i.loaded.length+s);var r=i.loaded[s];r&&_get.call(i,r.id).css({left:(o?"-":"")+100*a+"%",opacity:1})}requestAnimationFrame(function(){i.triggers.transitionEnd.call(i)})}}).attr("class","pulse-touch-container").appendTo(_ns[e].contentContainer);var l={start:{x:0,y:0},end:{x:null,y:null},move:!1};_ns[e].contentContainer.bind("touchstart touchmove touchend",function(t){i.options.transition_duration="500ms";var n=t.originalEvent.targetTouches[0];switch(t.type){case"touchstart":l.start.x=n.pageX,l.start.y=n.pageY,l.start.time=+new Date,l.end.x=null,l.move=!1;break;case"touchmove":l.end.x=n.pageX,l.end.y=n.pageY;var o=l.start.x-l.end.x,s=l.start.y-l.end.y;Math.abs(o/2)>Math.abs(s)&&(clearTimeout(i.playTimer.id),t.stopPropagation(),t.preventDefault(),l.move=!0,i.touchContainer.css(i.options.touchSwipePrefix+"transform","translate3d("+-o+"px,0,0)"));break;case"touchend":if(l.move){t.stopPropagation(),t.preventDefault();var a=l.start.x-l.end.x,r=0>a?-1:1;a=Math.abs(a);{var c=i.contentContainer.width(),u=+new Date,h=u-l.start.time,d=h/a,p=c-a;i.options.index+r}a>.07*c&&i.totalItems>1?(i.options.transition_duration=Math.min(500,Math.round(p*d))+"ms",_update.call(i,r)):_display.call(i)}else null===l.end.x&&(t.stopPropagation(),t.preventDefault(),_ns[e].contentContainer.trigger("click"))}})}else _ns[e].contentContainer.swipe({swipe:function(t,n){var i=_ns[$(t.target).closest(".pulse-content-container").closest(".pulse-main-container").parent().attr("id")];"left"===n?_update.call(i,1):"right"===n&&_update.call(i,-1)},allowPageScroll:"vertical"}),r.concat(["touchstart","touchmove","touchend"]);return _ns[e].contentContainer.bind(r.join(" "),function(t){if("mousedown"===t.type){if(-1===$.inArray(t.target.tagName.toLowerCase(),["embed","object","video"]))return;t.type="click"}var n=$(t.target),i=!1;if(n.hasClass("pulse-main-container")?i=n:n.closest(".pulse-content-container").closest(".pulse-main-container").parent().length>0&&(i=n.closest(".pulse-content-container").closest(".pulse-main-container")),i){var e=_ns[i.parent().attr("id")],o=_exists.call(e,"content"+t.type);if(o){var s={dom:e.current,data:e.currentData};if(-1===t.type.indexOf("touch")){var a=e.contentContainer.offset(),r=t.pageX-a.left,l=a.top-t.pageY;s.cursor={percentageX:Math.abs(Math.round(100*(r/e.contentContainer.width()).toFixed(2))),percentageY:Math.abs(Math.round(100*(l/e.contentContainer.height()).toFixed(2)))}}e.contentContainer.trigger(e.triggered="content"+t.type,s)}if("click"===t.type&&e.options.link_to){{var c,u=(e.options.dataUrl,!1);window.$K?window.$K.location.defaults:!1}if(e.options.data&&e.options.data.album_id?u=e.options.data.album_id:e.options.album_id&&(u=e.options.album_id),t.originalEvent&&"video"===t.originalEvent.target.tagName.toLowerCase())return;var h=location.href.match(/&preview=.*/)||"";switch(e.options.link_to){case"advance":return _update.call(e,1),void 0;case"playback":return _toggle.call(e),void 0;case"lightbox":case"content":if(c=e.currentData.__koken_url,"lightbox"===e.options.link_to&&!/\/lightbox\/$/.test(c))return c=$K.location.root+c+"lightbox/"+h,_pause.call(e),$K.lightbox.load(c),void 0;break;case"albums":c=e.originalData.albums[e.options.index].__koken_url;break;case"album":var d=RegExp(e.options.album_url.replace(/:[a-z_]+/,"[^/]+"));c=e.currentData.__koken_url&&d.test(e.currentData.__koken_url)?e.currentData.__koken_url.match(d)[0]:!1;break;default:c=e.options.link_to}c&&(location.href=(-1===c.indexOf("http://")?window.$K.location.root:"")+c+(-1===c.indexOf("http://")?h:""))}}}),_ns[e].container.append(_ns[e].contentContainer),_ns[e].realDims={width:_ns[e].contentContainer.width(),height:_ns[e].contentContainer.height()},$(window).bind("orientationchange resize webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){(!_ns.all||_ns.all.length<$(".pulse-main-container").length)&&(_ns.all=[],$(".pulse-main-container").each(function(t,n){_ns.all.push(_ns[$(n).parent().attr("id")])}));for(var t=0,n=_ns.all.length;n>t;t++){var i,e=_ns.all[t];if(i&&clearTimeout(i),!e)return;i=setTimeout(function(){e.contentContainer.trigger(e.triggered="resizecomplete")},200),_resize.call(e)}}).trigger("resize"),_ns[e].triggers={},_ns[e].triggers.play=function(){_play.call(this)},_ns[e].triggers.pause=function(){_pause.call(this)},_ns[e].triggers.toggle=function(){_toggle.call(this)},_ns[e].triggers.toggleFullScreen=function(){_toggleFullScreen.call(this)},_ns[e].triggers.transitionEnd=function(){this.transitioning=!1,this.options.touchSwipe||_load.call(this),_startPlaybackTimer.call(this),this.contentContainer.trigger(this.triggered="transitionend",{dom:this.current,data:this.currentData}),this.contentContainer.trigger(this.triggered="item",{dom:this.current,data:this.currentData})},_ns[e].triggers.videoReady=function(){this.current.find(".video-overlay").show()},_ns[e].triggers.videoStart=function(){this.current.find(".video-overlay").hide(),_pause.call(this),this.current.find(".video-container").css({left:0,top:0,margin:0,width:"100%",height:"100%",opacity:1}).data("resume","playing"===this.state),this.contentContainer.trigger(i.triggered="videobegin")},_ns[e].triggers.videoPause=function(){this.current.find(".video-overlay").show(),this.currentData.html?this.current.find(".video-container").css({top:"50%",left:"50%",width:"50px",height:"50px",margin:"-25px 0 0 -25px",opacity:.001}):this.current.find(".video-container").css("left",-1e4),this.contentContainer.trigger(i.triggered="videopause")},_ns[e].triggers.videoEnd=function(){this.current.find(".video-container").data("resume")&&(_update.call(this,1),this.state="playing"),this.contentContainer.trigger(i.triggered="videoend")},n&&$.each(n,function(t,n){_ns[e].options.hasOwnProperty(t)||(_ns[e].options[t]=n)}),_ns[e]},P.init=function(t,n){var i=_setup(t,n),e={context:i.context,options:$.extend({},i.options),on:function(t,n){var e=[];return $.each(t.split(" "),function(t,n){RegExp("^|\\s"+n+"\\s|$").test(_handles)&&e.push(n)}),e.length&&$.each(e,function(t,e){i.handlers.push(e),_bind.call(i,{type:e,fn:n})}),this},off:function(t){i.container.unlisten(t)},kill:function(){_kill.call(i)},play:function(){_play.call(i)},pause:function(){_pause.call(i)},next:function(){_update.call(i,1)},options:function(){return _options.call(i)},previous:function(){_update.call(i,-1)},toggle:function(){_toggle.call(i)},toggleFullscreen:function(){Pulse.fullScreenApi.supportsFullScreen&&_toggleFullScreen.call(i)},loadItem:function(t){_loadItemById.call(i,t)},loadItemAtPosition:function(t){_loadItemByIndex.call(i,t)},restart:function(){_loadItemByIndex.call(i,0,!0)},getItem:function(){return _getItem.call(i)},getNextItem:function(){return _getNextItem.call(i)},trigger:function(t){return i.dead?void 0:(i.triggers[t]?i.triggers[t].call(i):i.contentContainer.trigger(i.triggered=t,i.contentContainer),this)},ratio:function(t){return _ratio.call(i,t,!0)},append:function(t){t.css("position").length<=0&&t.css("position","relative"),t.css("zIndex",12),this.context.find(".pulse-main-container").append(t)},queue:function(){return _queue.call(i,!0)},clone:function(t){return _clone.call(i,t)}};i.options.touchSwipe?(Pulse.transitions._swipe.call(e,i.options),i.options.transition_duration="500ms"):Pulse.transitions[i.options.transition]?Pulse.transitions[i.options.transition].call(e,i.options):Pulse.transitions.dissolve.call(e,i.options);for(var o in window.Pulse.plugin)e[o]=window.Pulse.plugin[o];return $(function(){if(i.contentContainer.trigger(i.triggered="start",i.container),i.options.data&&i.options.data.content){var t={content:i.options.data.content,total:i.options.data.content.length,page:1,pages:1};_data.call(i,t)}else _data.call(i)}),e}}return P.init}.call({});window.Pulse.plugin={},window.Pulse.transitions={_swipe:function(t){var n=!1;this.on("transition",function(i){var e,o=i.next.parents(".pulse-touch-container");i.current&&i.next.attr("data-pulse-container")===i.current.attr("data-pulse-container")?(e=0,t.transition_duration="200ms"):e=o.width(),n||(i.next.css({left:e,opacity:1}),t.transition_duration="1ms",n=!0),i.forward&&(e=-e),o.css(t.touchSwipePrefix+"transition",t.touchSwipePrefix+"transform "+t.transition_duration+" ease-out"),requestAnimationFrame(function(){o.css(t.touchSwipePrefix+"transform","translate3d("+e+"px,0,0)")})})},none:function(){var t=this;this.on("transition",function(n){n.current&&n.current.css({opacity:0}),n.next.css({opacity:1}),t.trigger("transitionEnd")})},dissolve:function(t){var n=this;this.on("transition",function(i){i.current&&i.current.animate({opacity:0},{duration:t.transition_duration}),i.next.animate({opacity:1},{duration:t.transition_duration,complete:function(){n.trigger("transitionEnd")}})})},fade:function(t){var n=this;this.on("transition",function(i){i.current?i.current.animate({opacity:0},{duration:t.transition_duration/2,complete:function(){i.next.animate({opacity:1},{duration:t.transition_duration/2,complete:function(){n.trigger("transitionEnd")}})}}):i.next.animate({opacity:1},{duration:t.transition_duration,complete:function(){n.trigger("transitionEnd")}})})},slide:function(t){var n=this;this.on("transition",function(i){var e=n.context,o=n.clone(i.next),s=n.clone(i.current),a=e.width(),r=!1,l=$("<div/>").css({width:"100%",height:"100%",top:0,left:0,position:"absolute",overflow:"hidden"}),c=$("<div/>").css({width:2*a,height:"100%",top:0,left:i.forward?0:"-"+a+"px",position:"relative"}).appendTo(l),u=function(){i.next.css({opacity:1}),l.remove(),n.trigger("transitionEnd")},h=["Webkit","Moz","O","ms",""],d=!1;h.forEach(function(t){return t+"Transform"in document.body.style?(d=t,!1):void 0}),d&&(d.length&&(d="-"+d.toLowerCase()+"-"),c.css(d+"transition",d+"transform "+t.transition_duration+"ms "+t.transition_easing),r=!0),s&&(i.forward||s.css({left:a+"px"}),c.append(s)),o.css({opacity:1}),i.forward&&o.css({left:a+"px"}),c.append(o),n.append(l),window.setTimeout(function(){return i.current?("fill"!==n.options.crop&&i.current.css({opacity:0}),requestAnimationFrame(function(){a=i.forward?"-"+a:a,r?(c.bind("webkitTransitionEnd mozTransitionEnd msTransitionEnd oTransitionEnd transitionend",u),c.css(d+"transform","translate3d("+a+"px,0,0)")):c.animate({left:a},{duration:t.transition_duration,easing:t.transition_easing,complete:u})}),void 0):(u(),void 0)},i.current?50:250)})}},window.Pulse.register_transition=function(t){window.Pulse.transitions=$.extend(window.Pulse.transitions,t)},function(){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},n="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.cancelFullScreen)t.supportsFullScreen=!0;else for(var i=0,e=n.length;e>i;i++)if(t.prefix=n[i],"undefined"!=typeof document[t.prefix+"CancelFullScreen"]){t.supportsFullScreen=!0;break}t.supportsFullScreen&&(t.fullScreenEventName=t.prefix+"fullscreenchange",t.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},t.requestFullScreen=function(t){return""===this.prefix?t.requestFullScreen():t[this.prefix+"RequestFullScreen"]()},t.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),Pulse.fullScreenApi=t}();